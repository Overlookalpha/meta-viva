

<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta Viva</title>
<style>

body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  display:flex;
  justify-content:center;
}
.app{
  width:500px;
  min-height:100vh;
  padding:20px;
  box-sizing:border-box;
  position:relative;   /* IMPORTANTE */
  overflow:hidden;     /* impede scroll lateral */
}

.container{
  width:90%;
  max-width:500px;
  text-align:center;
  margin:0 auto;
}

h1{
  font-size:60px;
  margin-bottom:10px;
}

h2{
  margin-top:20px;
}

button{
  padding:12px 25px;
  border:none;
  border-radius:8px;
  margin-top:20px;
  cursor:pointer;
  font-size:16px;
}
.btnAcao{
  padding:10px 15px;
  font-size:15px;
  height:55px;
}

.primary{
  background:#00c896;
  color:white;
}

.secondary{
  background:#444;
  color:white;
  margin-left:10px;
}

.hidden{
  display:none;
}

.optionItem{
  display:block;
  margin:10px 0;
  text-align:left;
  background:rgba(255,255,255,0.1);
  padding:10px;
  border-radius:6px;
}

#progressText{
  font-size:14px;
  opacity:0.7;
}
/* PADR√ÉO MENU LATERAL */

.menuBtn{
  height:48px;
  width:100%;
  border:none;
  border-radius:10px;
  background:rgba(255,255,255,0.08);
  color:white;
  text-align:left;
  padding:0 15px;
  font-size:15px;
  cursor:pointer;
  transition:0.2s;
}

.menuBtn:hover{
  background:rgba(255,255,255,0.15);
}

.menuBtn:hover{
  background:rgba(255,255,255,0.15);
}

.cardResumo{
  background:rgba(255,255,255,0.1);
  padding:25px;
  border-radius:12px;
  transition:0.2s;
}

.cardResumo:hover{
  background:rgba(255,255,255,0.15);
}

.btnAcao{
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:14px;
  cursor:pointer;
}

.btnEntrada{
  background:#00c896;
  color:white;
}

.btnSaida{
  background:#ff3b30;
  color:white;
}

/* TELAS QUE ABREM POR CIMA */

.screen{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  padding:20px;
  box-sizing:border-box;
  display:none;
  z-index:10;
  overflow-y:auto;
}

.screen.active{
  display:block;
}
</style>
</head>

<body>

<div class="app">

<!-- LANDING -->
<div id="landing" style="position:relative;">

  <h1 style="
      font-size:80px;
      margin-bottom:15px;
      letter-spacing:3px;
      font-weight:800;
  ">
    Meta Viva
  </h1>

  <p style="
      font-size:22px;
      margin-bottom:10px;
      font-weight:300;
  ">
    Transforme seus sonhos em metas alcan√ß√°veis.
  </p>

  <p style="
      font-size:16px;
      opacity:0.85;
      max-width:420px;
      margin:0 auto 35px auto;
      line-height:1.5;
  ">
    Planeje sua vida financeira, crie objetivos reais,
    acompanhe sua evolu√ß√£o e conquiste estabilidade
    com clareza e dire√ß√£o.
  </p>

  <button class="primary"
      onclick="start()"
      style="
        font-size:18px;
        padding:16px 32px;
        border-radius:10px;
        box-shadow:0 4px 20px rgba(0,0,0,0.3);
      ">
      Criar Meu Plano Gratuito
  </button>

  <div style="
      position:absolute;
      bottom:-80px;
      left:0;
      right:0;
      font-size:12px;
      opacity:0.5;
  ">
      Produzido por <strong>Overlock</strong> (Isa√≠as Rodrigues)
  </div>

</div>
<!-- QUIZ -->
<div id="quiz" class="hidden">

  <div id="progressText"></div>
  <h2 id="questionText"></h2>
  <div id="options"></div>

  <button class="primary" id="nextBtn" onclick="nextQuestion()">Pr√≥ximo</button>
  <button class="secondary" onclick="previousQuestion()">Anterior</button>

</div>

<!-- RESULTADO -->
<div id="result" class="hidden">

  <h1 style="font-size:42px; margin-bottom:10px;">
    Seu Plano Est√° Pronto üéØ
  </h1>

  <p style="font-size:20px; opacity:0.9; margin-bottom:20px;">
    Analisamos suas respostas e criamos uma estrat√©gia personalizada
    para transformar sua situa√ß√£o financeira passo a passo.
  </p>

  <div style="margin-top:30px; font-size:18px; line-height:1.6; opacity:0.85;">
    ‚úî Organiza√ß√£o financeira clara<br>
    ‚úî M√©todo de economia adaptado ao seu perfil<br>
    ‚úî Plano para sair da instabilidade<br>
    ‚úî Estrat√©gia de crescimento consistente
  </div>
<div id="profileResult" style="margin-top:20px; font-size:18px;"></div>

 <button class="primary"
        style="margin-top:35px; font-size:18px; padding:14px 30px;"
        onclick="goToLogin()">
  Ir para Meu Painel
</button>

</div>

<!-- LOGIN -->
<div id="login" class="hidden">

  <h2>Crie sua conta para acessar seu painel</h2>

  <input type="text" id="name" placeholder="Seu nome" style="width:100%; padding:10px; margin-top:15px; border-radius:6px; border:none;">

  <input type="email" id="email" placeholder="Seu e-mail" style="width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none;">

  <input type="password" id="password" placeholder="Sua senha" style="width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none;">

  <button class="primary" style="margin-top:20px;" onclick="createAccount()">
    Criar Conta e Acessar Painel
  </button>

</div>

<!-- SETUP RENDA -->
<div id="setupRenda" class="hidden">

  <h2>Defina sua renda mensal base</h2>

  <p style="opacity:0.8; font-size:14px; margin-top:10px;">
    Essa informa√ß√£o ser√° usada para montar sua estrutura financeira.
  </p>

  <input 
    type="number" 
    id="rendaInput" 
    placeholder="Digite sua renda mensal"
    style="width:100%; padding:10px; margin-top:15px; border-radius:6px; border:none;"
  >
  <p style="margin-top:15px;">Qual moeda voc√™ utiliza?</p>

<select id="moedaSelect"
  style="width:100%; padding:10px; border-radius:6px; border:none; margin-top:5px;">
  
  <option value="‚Ç¨">Euro (‚Ç¨)</option>
  <option value="R$">Real (R$)</option>
  <option value="$">D√≥lar ($)</option>
  <option value="¬£">Libra (¬£)</option>

</select>

  <button 
    class="primary" 
    style="margin-top:20px;"
    onclick="confirmarRenda()">
    Confirmar e Montar Estrutura
  </button>

</div>


<!-- HOME -->
<div id="home" class="hidden">

  <!-- üîî BANNER DO MENTOR (fica acima de tudo) -->
  <div id="mentorBanner" 
       style="display:none;
              background:#111;
              padding:15px;
              border-radius:8px;
              margin-bottom:15px;
              font-size:14px;">
  </div>

  <div style="
    width:100%;
    display:flex;
    gap:20px;
    align-items:flex-start;
  ">
    <!-- COLUNA 1 - MENU -->
    <div style="width:30%;">

      <div style="display:flex; flex-direction:column; gap:10px; width:100%;">

        <button class="menuBtn" onclick="abrirAba('home')">üè† Home</button>
        <button class="menuBtn" onclick="abrirTela('telaDesafios'); carregarPlanoDesafio();">
         üéØ Desafios
        </button>
        <button class="menuBtn" onclick="abrirTela('telaCategorias'); setTimeout(atualizarTelaCategorias, 10);">üóÇÔ∏è Categorias</button>
        <button class="menuBtn" onclick="abrirTela('telaRelatorio'); preencherFiltrosRelatorio(); gerarRelatorio();">üìä Relat√≥rios</button>
        <button class="menuBtn" onclick="abrirAba('reserva')">üí∞ Reserva</button>
        <button class="menuBtn" onclick="abrirAba('emprestimo')">üè¶ Empr√©stimo</button>
        <button class="menuBtn" onclick="abrirAba('contas')">üßæ Contas a Pagar</button>
        <button class="menuBtn" onclick="abrirAba('configuracoes')">‚öôÔ∏è Configura√ß√µes</button>

      </div>

    </div>

    <!-- COLUNA 2 - CONTE√öDO -->
    <div style="width:60%;">

     <!-- PERFIL -->
<div style="
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
">

  <!-- BLOCO ESQUERDA (foto + infos) -->
  <div style="display:flex; align-items:center; gap:15px;">

    <!-- FOTO -->
    <div style="
      width:60px;
      height:60px;
      background:#444;
      border-radius:50%;
    "></div>

    <!-- INFOS -->
    <div>
      <h3 style="margin:0;">Nome do Usu√°rio</h3>

      <p id="perfilTipo" style="margin:0; font-size:14px; opacity:0.7;">
        Perfil: ‚Äî
      </p>

      <p id="dividaHeader" style="margin:0; font-size:14px; color:#ff6b6b; display:none;">
        üí≥ D√≠vida: 0
      </p>

      <p id="contasResumo"
        onclick="abrirAba('telaContas')"
        style="margin:0; font-size:14px; cursor:pointer;">
        üßæ Contas: üü¢ Nenhuma pendente
      </p>
    </div>

  </div>

  <!-- BLOCO DIREITA (a√ß√µes) -->
  <div style="display:flex; gap:12px;">

    <!-- üß† MENTOR -->
    <button onclick="analisarSituacaoFinanceira(true)"
      style="
        width:44px;
        height:44px;
        border-radius:50%;
        border:none;
        cursor:pointer;
        font-size:26px;
        background:linear-gradient(135deg,#6a11cb,#2575fc);
        box-shadow:0 4px 12px rgba(0,0,0,0.3);
      ">
      üß†
    </button>

    <!-- üîî NOTIFICA√á√ÉO -->
    <div style="position:relative;">
      <button
        style="
          width:44px;
          height:44px;
          border-radius:50%;
          border:none;
          cursor:pointer;
          font-size:26px;
          background:linear-gradient(135deg,#ff9966,#ff5e62);
          box-shadow:0 4px 12px rgba(0,0,0,0.3);
        ">
        üîî
      </button>

      <span id="badgeNotificacao"
        style="
          position:absolute;
          top:-4px;
          right:-4px;
          background:#ff3b30;
          color:white;
          font-size:11px;
          padding:3px 6px;
          border-radius:12px;
          display:none;
        ">
      </span>
    </div>

  </div>

</div>

      <!-- RESUMO -->
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px;">

        <div class="cardResumo">
          <p>Saldo</p>
          <h3 id="saldoValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>Reserva</p>
          <h3 id="reservaValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>Entradas</p>
          <h3 id="entradaValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>Sa√≠das</p>
          <h3 id="saidaValor">0</h3>
        </div>

      </div>

      <!-- BOT√ïES -->
      
      <!-- META MENSAL -->
<div style="margin-top:25px;">

  <p style="margin:5px 0; font-size:14px; opacity:0.8;">
    Meta do m√™s: <span id="moedaMeta"></span><span id="metaValor">0</span>
  </p>

  <div style="background:#333; border-radius:10px; height:18px; overflow:hidden;">
    <div id="barraMeta" style="
      height:18px;
      width:0%;
      background:#00c896;
      transition:0.4s;
    "></div>
  </div>

  <p style="margin-top:5px; font-size:13px; opacity:0.7;">
    Guardado: <span id="moedaGuardado"></span><span id="guardadoValor">0</span>
  </p>
  </div>
  <!-- BOT√ïES -->
<div style="display:flex; gap:15px; margin-top:15px;">

  <button class="btnAcao btnEntrada" style="flex:1;" onclick="abrirTela('telaEntrada')">
    + Entrada
  </button>

  <button class="btnAcao btnSaida" style="flex:1;" onclick="abrirTelaSaida()">
  - Sa√≠da
</button>
 </div>

    </div>

  </div>

</div>
<!-- DESAFIOS -->
<div id="desafios" class="hidden">
  <h2>Desafios</h2>
</div>

<!-- NOVO DESAFIO -->
<div id="novoDesafio" class="hidden">
  <h2>Criar Novo Desafio</h2>
</div>

<!-- CATEGORIAS -->
<!-- TELA CATEGORIAS -->
<div id="telaCategorias" class="screen">

  <button onclick="fecharTela('telaCategorias')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    ‚Üê Voltar
  </button>

  <h2 style="margin-top:0;">üóÇÔ∏è Categorias</h2>

  <div id="listaCategorias" style="margin-top:20px;"></div>

</div>
<!-- TELA ENTRADA -->
<div id="telaEntrada" class="screen">

  <button onclick="fecharTela('telaEntrada')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h2>+ Registrar Entrada</h2>

  <p>Nome do Cliente:</p>
  <input type="text" id="nomeClienteInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorEntradaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="confirmarEntrada()"
    style="margin-top:20px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Confirmar Entrada
  </button>

</div>
<!-- TELA SA√çDA -->
<div id="telaSaida" class="screen">

  <button onclick="fecharTela('telaSaida')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h2>- Registrar Sa√≠da</h2>

  <p>Categoria:</p>
  <select id="selectCategoria" style="width:100%;padding:8px;border-radius:6px;border:none;"></select>

  <p style="margin-top:15px;">Subcategoria:</p>
  <select id="selectSubcategoria" style="width:100%;padding:8px;border-radius:6px;border:none;"></select>

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorSaidaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="confirmarSaida()"
    style="margin-top:20px;background:#ff4d4d;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Confirmar Sa√≠da
  </button>
  
  <div style="display:flex; gap:10px; margin-top:25px;">

  <button
    onclick="adicionarSubcategoria()"
    style="flex:1;background:#00c896;border:none;padding:10px;border-radius:8px;color:white;cursor:pointer;">
    ‚ûï Adicionar Subcategoria
  </button>

  <button
    onclick="excluirSubcategoria()"
    style="flex:1;background:#ff4d4d;border:none;padding:10px;border-radius:8px;color:white;cursor:pointer;">
    üóëÔ∏è Excluir Subcategoria
  </button>

</div>

</div>
  
<!-- RELATORIOS -->
<div id="relatorios" class="hidden">
  <h2>Relat√≥rios</h2>
</div>

<!-- RESERVA -->
<!-- RESERVA -->
<div id="reserva" class="hidden">
  <h2>üí∞ Reserva Emergencial</h2>
  <button onclick="abrirAba('home')"
        style="background:none;
               border:none;
               color:white;
               font-size:16px;
               margin-bottom:20px;
               cursor:pointer;">
  ‚Üê Voltar
</button>

  <p style="margin-top:20px;">
    Meta do m√™s: <span id="reservaMetaTexto">0</span>
  </p>

  <p>
    Guardado at√© agora: <span id="reservaGuardadoTexto">0</span>
  </p>

  <p>
    Falta: <span id="reservaFaltaTexto">0</span>
  </p>

  <!-- üîπ BLOCO GUARDAR NORMAL (perfil) -->
  <div style="margin-top:20px;">
    <input 
      type="number" 
      id="valorGuardarInput" 
      placeholder="Digite valor para guardar"
      style="width:100%; padding:10px; border-radius:6px; border:none;">
  </div>

  <button class="primary" style="margin-top:15px;" onclick="guardarNaReserva()">
    Guardar Valor
  </button>

  <!-- üîπ BLOCO SISTEMA 10% -->
  <div id="blocoSistema10" style="margin-top:25px; display:none;">

    <hr style="opacity:0.2; margin-bottom:20px;">

    <h3>üìä Separa√ß√£o 10%</h3>

    <p>
      üì• 10% das Entradas: 
      <span id="pendenteEntradasTexto">0.00</span>
    </p>

    <p>
      üì§ 10% das Sa√≠das: 
      <span id="pendenteSaidasTexto">0.00</span>
    </p>

    <p>
      <strong>Total a Separar: 
        <span id="pendenteTotalTexto">0.00</span>
      </strong>
    </p>

    <div style="margin-top:15px;">
      <input 
        type="number" 
        id="valorSepararManualInput"
        placeholder="Quanto voc√™ quer separar agora"
        style="width:100%; padding:10px; border-radius:6px; border:none;">
    </div>

    <button class="primary" style="margin-top:10px;" onclick="separarManual10()">
      Separar Agora
    </button>

  </div>

</div>

<!-- EMPRESTIMO -->
<div id="emprestimo" class="hidden">

  <h2>üè¶ Empr√©stimo Interno</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <p>D√≠vida Atual: <span id="dividaAtualTexto">0.00</span></p>

  <p style="margin-top:20px;">Valor para pegar emprestado:</p>
  <input type="number" id="valorEmprestimoInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="pegarEmprestimo()"
    style="margin-top:15px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Pegar Empr√©stimo
  </button>

  <p style="margin-top:30px;">Valor para pagar:</p>
  <input type="number" id="valorPagamentoInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="pagarEmprestimo()"
    style="margin-top:15px;background:#ff4d4d;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Pagar Empr√©stimo
  </button>

</div>

<!-- CONTAS A PAGAR -->
<div id="contas" class="hidden">

  <h2>üßæ Contas a Pagar</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>
  <button 
  onclick="abrirTela('telaNovaConta')" 
  style="
    margin-bottom:15px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;">
  ‚ûï Nova Conta
</button>
  <div id="listaContas"></div>

</div>

<!-- CONFIGURACOES -->
<div id="configuracoes" class="hidden">

  <h2>‚öôÔ∏è Configura√ß√µes</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h3 style="margin-top:20px;">üîß Ajuste Manual de Saldo</h3>

  <p style="opacity:0.8; font-size:14px;">
    Use valores positivos para adicionar e negativos para remover.
  </p>

  <input 
    type="number" 
    id="ajusteSaldoInput"
    placeholder="Ex: 200 ou -150"
    style="width:100%; padding:10px; border-radius:6px; border:none; margin-top:10px;"
  >

  <button class="primary" style="margin-top:15px;" onclick="aplicarAjusteSaldo()">
    Aplicar Ajuste
  </button>
  <hr style="margin:30px 0; opacity:0.2;">

<h3>üìä Sistema de Separa√ß√£o 10%</h3>

<label style="display:flex; align-items:center; gap:10px; margin-top:10px; cursor:pointer;">
  <input type="checkbox" id="toggleSistema10" onchange="toggleSistema10()">
  Ativar separa√ß√£o autom√°tica de 10% (Entradas + Sa√≠das)
</label>

</div>

<!-- TELA DESAFIOS (NOVA TELA) -->
<div id="telaDesafios" class="screen">

  <button onclick="fecharTela('telaDesafios')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    ‚Üê Voltar
  </button>

  <h2 style=";">üéØ Desafios</h2>
 <button 
  onclick="abrirTela('telaNovoDesafio')"
  style="
    margin-top:15px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;
  ">
  ‚ûï Criar Novo Desafio
</button>

  <div style="margin-top:20px; text-align:left;">
  
  <div id="listaDesafios" style="margin-top:20px;"></div>
  <h3 id="tituloPlano"></h3>

  <ul id="etapasPlano" style="margin-top:15px; line-height:1.6;"></ul>

  <div style="margin-top:20px;">
    <p>Meta atual: <span id="desafioMeta">0</span></p>
    <p>Progresso: <span id="desafioProgresso">0</span>%</p>
  <div style="background:#333; border-radius:10px; height:18px; overflow:hidden; margin-top:10px;">
  <div id="barraDesafio" style="
    height:18px;
    width:0%;
    background:#00c896;
    transition:0.4s;
  "></div>
  </div>

</div>
</div>

 <!-- TELA NOVO DESAFIO -->
<div id="telaNovoDesafio" class="screen">

  <button onclick="fecharTela('telaNovoDesafio')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    ‚Üê Voltar
  </button>

  <h2 style="margin-top:0;">‚ú® Criar Novo Desafio</h2>

  <div style="margin-top:20px; text-align:left;">

    <p>Nome do desafio:</p>
    <input type="text" id="nomeDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Valor total:</p>
    <input type="number" id="valorDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Dividir em quantas partes?</p>
    <input type="number" id="partesDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Escolha um emoji:</p>

  <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
  <span onclick="selecionarEmoji('‚úàÔ∏è')" style="cursor:pointer; font-size:22px;">‚úàÔ∏è</span>
  <span onclick="selecionarEmoji('üì±')" style="cursor:pointer; font-size:22px;">üì±</span>
  <span onclick="selecionarEmoji('üíª')" style="cursor:pointer; font-size:22px;">üíª</span>
  <span onclick="selecionarEmoji('üöó')" style="cursor:pointer; font-size:22px;">üöó</span>
  <span onclick="selecionarEmoji('üéÅ')" style="cursor:pointer; font-size:22px;">üéÅ</span>
  <span onclick="selecionarEmoji('üê∑')" style="cursor:pointer; font-size:22px;">üê∑</span>
  <span onclick="selecionarEmoji('üéÇ')" style="cursor:pointer; font-size:22px;">üéÇ</span>
  <span onclick="selecionarEmoji('üí∞')" style="cursor:pointer; font-size:22px;">üí∞</span>
  <span onclick="selecionarEmoji('üì¶')" style="cursor:pointer; font-size:22px;">üì¶</span>
  <span onclick="selecionarEmoji('üéØ')" style="cursor:pointer; font-size:22px;">üéØ</span>
</div>

    <button onclick="criarDesafioPersonalizado()" 
      style="
        margin-top:20px;
        background:#00c896;
        border:none;
        padding:10px 15px;
        border-radius:8px;
        color:white;
        cursor:pointer;
      ">
      Criar Desafio
    </button>

  </div>

</div>

<!-- TELA DETALHE DESAFIO -->
<div id="telaDetalheDesafio" class="screen">

  <button onclick="fecharTela('telaDetalheDesafio')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h2 id="tituloDetalhe"></h2>

  <p>Total: <span id="valorTotalDetalhe"></span></p>
  <p>Parcela: <span id="valorParcelaDetalhe"></span></p>

  <div id="areaParcelas" style="margin-top:20px; font-size:28px;"></div>

  <button onclick="pagarParcela()" style="
    margin-top:25px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;">
    üí∏ Pagar Parcela
  </button>
  <button onclick="encerrarDesafio()" style="
  margin-top:15px;
  background:#444;
  border:none;
  padding:10px 15px;
  border-radius:8px;
  color:white;
  cursor:pointer;">
  ‚úî Encerrar Desafio
</button>

</div>
  </div>

<!-- TELA RELAT√ìRIO -->
<div id="telaRelatorio" class="screen">

  <button onclick="fecharTela('telaRelatorio')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h2 style="margin-top:0;">üìä Relat√≥rio Financeiro</h2>
  <div style="margin:15px 0; display:flex; gap:10px; flex-wrap:wrap;">

  <select id="filtroMes" style="padding:6px;border-radius:6px;border:none;">
    <option value="todos">Todos os Meses</option>
  </select>

  <select id="filtroCategoria" style="padding:6px;border-radius:6px;border:none;">
    <option value="todas">Todas Categorias</option>
  </select>

  <button onclick="gerarRelatorio()"
    style="background:#00c896;border:none;padding:6px 10px;border-radius:6px;color:white;cursor:pointer;">
    Aplicar Filtro
  </button>
  <button onclick="gerarPDF()"
  style="background:#444;border:none;padding:6px 10px;border-radius:6px;color:white;cursor:pointer;">
  Gerar PDF
</button>

</div>

  <div id="conteudoRelatorio" style="margin-top:20px;"></div>

</div>

<!-- TELA NOVA CONTA -->
<div id="telaNovaConta" class="screen">

  <button onclick="fecharTela('telaNovaConta')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    ‚Üê Voltar
  </button>

  <h2>‚ûï Nova Conta</h2>

  <p>Nome da Conta:</p>
  <input type="text" id="nomeContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Data de Vencimento:</p>
  <input type="date" id="vencimentoContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="salvarNovaConta()"
    style="margin-top:20px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Salvar Conta
  </button>

</div>
  
<script>

let progresso = 0;
let currentQuestion = 0;
let answers = [];
let userProfile = "";
let emojiSelecionado = "üéØ";
let desafios = [];
const mapaEmojis = {
  "viagem": "‚úàÔ∏è",
  "viajar": "‚úàÔ∏è",
  "passagem": "‚úàÔ∏è",

  "celular": "üì±",
  "iphone": "üì±",

  "computador": "üíª",
  "notebook": "üíª",

  "carro": "üöó",
  "autom√≥vel": "üöó",

  "presente": "üéÅ",
  "natal": "üéÅ",
  "anivers√°rio": "üéÇ",
  "p√°scoa": "üéÅ",

  "dinheiro": "üí∞",
  "reserva": "üí∞",

  "meta": "üéØ",
  "objetivo": "üéØ",

  "caixa": "üì¶"
};
let saldo = 0;
let dividaAtual = 0;
// ===== SISTEMA 10% OPCIONAL =====
let sistema10Ativo = false;
let estadoMentorAtual = "estavel";
let pendenteEntradas = 0;
let pendenteSaidas = 0;
// üîî SISTEMA DE NOTIFICA√á√ïES
let notificacoes = [];
let notificacoesNaoLidas = 0;
let desafioAtualIndex = null;
// üîä CONTROLE DE VOZ
let vozAtivada = true;
let rendaMensalBase = 0;
let moedaUsuario = "‚Ç¨";
let categorias = [];
let historicoSaidas = [];
let contas = [];
function selecionarEmoji(emoji){

  emojiSelecionado = emoji;

  const nomesPadrao = {
    "‚úàÔ∏è": "Viagem",
    "üì±": "Celular",
    "üíª": "Computador",
    "üöó": "Carro",
    "üéÅ": "Presente",
    "üê∑": "Reserva",
    "üéÇ": "Anivers√°rio",
    "üí∞": "Dinheiro",
    "üì¶": "Compra",
    "üéØ": "Meta"
  };

  if(nomesPadrao[emoji]){
    document.getElementById("nomeDesafio").value = nomesPadrao[emoji];
  }

}
/* ===== PLANOS POR PERFIL ===== */
let metaMensal = 0;
let valorGuardado = 0;
const planosPerfil = {

  "Cr√≠tico": {
    porcentagem: 0.05,
    titulo: "Plano de Reorganiza√ß√£o Financeira",
    etapas: [
      "Guardar 5% de cada entrada.",
      "Registrar todos os gastos por 30 dias.",
      "Criar disciplina antes de aumentar a meta."
    ]
  },

  "Iniciante": {
    porcentagem: 0.08,
    titulo: "Plano de Constru√ß√£o de Base",
    etapas: [
      "Guardar 8% de cada entrada.",
      "Separar despesas fixas e vari√°veis.",
      "Criar reserva equivalente a 1 m√™s."
    ]
  },

  "Em Evolu√ß√£o": {
    porcentagem: 0.10,
    titulo: "Plano de Crescimento",
    etapas: [
      "Guardar 10% de cada entrada.",
      "Eliminar desperd√≠cios mensais.",
      "Fortalecer reserva progressivamente."
    ]
  },

  "Intermedi√°rio": {
    porcentagem: 0.15,
    titulo: "Plano de Consolida√ß√£o",
    etapas: [
      "Guardar 15% de cada entrada.",
      "Expandir reserva para 3 meses.",
      "Criar metas de investimento."
    ]
  },

  "Est√°vel": {
    porcentagem: 0.20,
    titulo: "Plano de Independ√™ncia",
    etapas: [
      "Guardar 20% de cada entrada.",
      "Criar fundo estrat√©gico.",
      "Preparar capital para investimento."
    ]
  }

};
  
const questions = [

{
  question: "Qual seu maior objetivo financeiro?",
  multi: true,
  options: [
    "Criar reserva de emerg√™ncia",
    "Fazer uma viagem",
    "Comprar um carro",
    "Quitar d√≠vidas",
    "Ter maior estabilidade financeira"
  ]
},

{
  question: "Como est√° sua organiza√ß√£o hoje?",
  multi: false,
  options: [
    "N√£o consigo guardar nada",
    "Guardo pouco, mas sem m√©todo",
    "J√° guardo, mas quero melhorar",
    "Tenho controle total"
  ]
},

{
  question: "Voc√™ controla seus gastos mensalmente?",
  multi: false,
  options: [
    "N√£o controlo",
    "Controlo √†s vezes",
    "Controlo quase tudo",
    "Controlo tudo detalhadamente"
  ]
},

{
  question: "Voc√™ possui d√≠vidas atualmente?",
  multi: false,
  options: [
    "Sim, muitas",
    "Algumas",
    "Poucas",
    "Nenhuma"
  ]
},

{
  question: "Quanto voc√™ consegue guardar por m√™s?",
  multi: false,
  options: [
    "Nada",
    "At√© 5%",
    "Entre 10% e 20%",
    "Mais de 20%"
  ]
}

];

function start(){
  document.getElementById("landing").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  currentQuestion = 0;
  loadQuestion();
}

function loadQuestion(){

  const q = questions[currentQuestion];

  document.getElementById("progressText").innerText =
    "Pergunta " + (currentQuestion + 1) + " de " + questions.length;

  document.getElementById("questionText").innerText = q.question;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  q.options.forEach(option => {

    const label = document.createElement("label");
    label.className = "optionItem";

    const input = document.createElement("input");
    input.type = q.multi ? "checkbox" : "radio";
    input.name = "option";
    input.value = option;

    label.appendChild(input);
    label.appendChild(document.createTextNode(" " + option));

    optionsDiv.appendChild(label);
  });

  if(currentQuestion === questions.length - 1){
    document.getElementById("nextBtn").innerText = "Gerar Plano";
  } else {
    document.getElementById("nextBtn").innerText = "Pr√≥ximo";
  }

}

function nextQuestion(){

  const selected = document.querySelectorAll("input[name='option']:checked");

  if(selected.length === 0){
    alert("Selecione pelo menos uma op√ß√£o.");
    return;
  }

  answers[currentQuestion] = [];

  selected.forEach(el => {
    answers[currentQuestion].push(el.value);
  });

  if(currentQuestion < questions.length - 1){
    currentQuestion++;
    loadQuestion();
  } else {
    showResult();
  }

}

function previousQuestion(){
  if(currentQuestion > 0){
    currentQuestion--;
    loadQuestion();
  }
}

function generateProfile() {

  const dividas = answers[3]?.[0] || "";
  const guardar = answers[4]?.[0] || "";
  console.log("Valor guardar:", guardar);
  const controle = answers[2]?.[0] || "";

  if (
    dividas === "Sim, muitas" &&
    guardar === "Nada" &&
    controle === "N√£o controlo"
  ) {
    userProfile = "Cr√≠tico";
  }

  else if (
    dividas === "Algumas" &&
    (guardar === "Nada" || guardar === "At√© 5%")
  ) {
    userProfile = "Iniciante";
  }

  else if (
    guardar === "Entre 10% e 20%"
  ) {
    userProfile = "Intermedi√°rio";
  }

  else if (
    guardar === "Mais de 20%" &&
    dividas === "Nenhuma"
  ) {
    userProfile = "Est√°vel";
  }

  else {
    userProfile = "Em Evolu√ß√£o";
  }

}

function showResult(){

  generateProfile();
  console.log(answers);
  document.getElementById("quiz").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");

  document.getElementById("profileResult").innerHTML =
    "<strong>Seu Perfil:</strong> " + userProfile;

}
  
function goToLogin(){

  document.getElementById("result").classList.add("hidden");
  document.getElementById("login").classList.remove("hidden");

}

function goToHome(){
 const plano = planosPerfil[userProfile];

if(plano){
   metaMensal = rendaMensalBase * plano.porcentagem;
   }
  generateProfile();
  console.log("Perfil gerado:", userProfile);

  document.getElementById("setupRenda").classList.add("hidden");
  document.getElementById("login").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
  document.getElementById("perfilTipo").innerText = "Perfil: " + userProfile;
  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);
  document.getElementById("guardadoValor").innerText = valorGuardado.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);
  // ===== ATIVAR PLANO AUTOM√ÅTICO DO PERFIL =====


 
  let objetivo = answers[0][0];
  let desafio = "";
  let estrategia = "";
  if(objetivo === "Comprar um carro"){
    estrategia = "Criar fundo espec√≠fico para o carro e guardar 15% mensalmente.";
  }
  else if(objetivo === "Quitar d√≠vidas"){
    estrategia = "Priorizar pagamento das d√≠vidas antes de iniciar novos objetivos.";
  }
  else if(objetivo === "Criar reserva de emerg√™ncia"){
    estrategia = "Construir reserva equivalente a 6 meses de despesas.";
  }
  

  if(userProfile === "Cr√≠tico"){
    desafio = "Anotar todos os gastos por 7 dias.";

  }

  else if(userProfile === "Iniciante"){
    desafio = "Guardar 5% da sua renda por 30 dias.";

  }

  else if(userProfile === "Intermedi√°rio"){
    desafio = "Criar reserva de 3 meses.";

  }

  else if(userProfile === "Est√°vel"){
    desafio = "Investir para crescimento.";

  }

  else{
    desafio = "Organizar despesas fixas.";

  }
  // document.getElementById("homeDescricaoPlano").innerText = estrategia;
  // document.getElementById("homeDesafioTexto").innerText = desafio;
  atualizarDividaHeader();
  atualizarResumoContas();
  atualizarProgresso();
}

function createAccount(){

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if(!name || !email || !password){
    alert("Preencha todos os campos.");
    return;
  }

  alert("Conta criada com sucesso!");

  document.getElementById("login").classList.add("hidden");  // ESCONDE LOGIN
  document.getElementById("setupRenda").classList.remove("hidden");

  }

function abrirDesafios(){
  document.getElementById("areaDesafios").classList.remove("hidden");

  // Rola suavemente at√© a √°rea de desafios
  document.getElementById("areaDesafios").scrollIntoView({
    behavior: "smooth"
  });
}
  
function concluirDesafio(){

  if(progresso < 100){
    progresso += 20;
  }

  if(progresso > 100){
    progresso = 100;
  }

  document.getElementById("progressBar").style.width = progresso + "%";
  document.getElementById("progressTextBar").innerText = "Progresso: " + progresso + "%";

}

let entradasTotal = 0;
let saidasTotal = 0;
let historicoEntradas = [];


  // üî• Agora entra o c√©rebro do desafio

   function adicionarEntrada(){

  let valor = parseFloat(prompt("Digite o valor da entrada:"));

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  entradasTotal += valor;
  saldo += valor;
  // Atualiza meta baseada no perfil (apenas c√°lculo, n√£o guarda dinheiro)

  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);


  document.getElementById("entradaValor").innerText = moedaUsuario + " " + entradasTotal.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  atualizarProgresso();
  }

function adicionarSaida(){

  if(categorias.length === 0){
    alert("Nenhuma categoria criada.");
    return;
  }

  // Escolher categoria
  let nomesCategorias = categorias
  .map((c, i) => `${i} - ${c.nome}`)
  .join("\n");

  let escolhaCategoria = prompt(
    "Escolha a categoria digitando o n√∫mero:\n\n" + nomesCategorias
  );

  if(escolhaCategoria === null) return;

  let indexCategoria = parseInt(escolhaCategoria);

  if(isNaN(indexCategoria) || !categorias[indexCategoria]){
    alert("Categoria inv√°lida.");
    return;
  }

  let categoria = categorias[indexCategoria];

  // Escolher subcategoria
  let nomesSub = categoria.subcategorias
  .map(function(s, i){
    return i + " - " + s.nome;
  })
  .join("\n");

  let escolhaSub = prompt(
    `Escolha a subcategoria de ${categoria.nome}:\n\n` + nomesSub
  );

  if(escolhaSub === null) return;

  let indexSub = parseInt(escolhaSub);

  if(isNaN(indexSub) || !categoria.subcategorias[indexSub]){
    alert("Subcategoria inv√°lida.");
    return;
  }

  let valor = parseFloat(prompt("Digite o valor da sa√≠da:"));

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  // Atualiza valores
  saldo -= valor;
  saidasTotal += valor;
  categoria.subcategorias[indexSub].total += valor;

  // Atualiza UI
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("saidaValor").innerText = moedaUsuario + " " + saidasTotal.toFixed(2);

  atualizarTelaCategorias();
}

function abrirAba(id){

  // Esconde todas as abas
  document.getElementById("home").classList.add("hidden");
  document.getElementById("desafios").classList.add("hidden");
  document.getElementById("novoDesafio").classList.add("hidden");
  document.getElementById("relatorios").classList.add("hidden");
  document.getElementById("reserva").classList.add("hidden");
  document.getElementById("emprestimo").classList.add("hidden");
  document.getElementById("configuracoes").classList.add("hidden");
  document.getElementById("contas").classList.add("hidden"); // üî• ESTA LINHA FALTAVA

  if(id === "reserva"){

    document.getElementById("reservaGuardadoTexto").innerText = valorGuardado.toFixed(2);
    document.getElementById("reservaMetaTexto").innerText = metaMensal.toFixed(2);
    if(sistema10Ativo){
    document.getElementById("blocoSistema10").style.display = "block";
    atualizarTelaSistema10();
    } else {
    document.getElementById("blocoSistema10").style.display = "none";
    }
    let falta = metaMensal - valorGuardado;
    if(falta < 0) falta = 0;

    document.getElementById("reservaFaltaTexto").innerText = falta.toFixed(2);
    atualizarSistema10Visual();
  }

  // Mostra a aba clicada
  document.getElementById(id).classList.remove("hidden");

  if(id === "contas"){
    atualizarListaContas();
  }

  atualizarResumoContas();
}
function guardarNaReserva(){

  let valor = parseFloat(document.getElementById("valorGuardarInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  if(valor > saldo){
    alert("Voc√™ n√£o tem saldo suficiente.");
    return;
  }

  // Move dinheiro do saldo para reserva oficial
  saldo -= valor;
  valorGuardado += valor;

  // Atualiza UI principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  atualizarProgresso();

  // Atualiza tela da reserva
  document.getElementById("reservaGuardadoTexto").innerText = valorGuardado.toFixed(2);

  let falta = metaMensal - valorGuardado;
  if(falta < 0) falta = 0;

  document.getElementById("reservaMetaTexto").innerText = metaMensal.toFixed(2);
  document.getElementById("reservaFaltaTexto").innerText = falta.toFixed(2);

  document.getElementById("valorGuardarInput").value = "";
  atualizarProgresso();
  abrirAba("home");
}

function carregarPlanoDesafio(){

  if(!planosPerfil[userProfile]) return;

  const plano = planosPerfil[userProfile];

  // T√≠tulo
  document.getElementById("tituloPlano").innerText = plano.titulo;

  // Etapas
  const lista = document.getElementById("etapasPlano");
  lista.innerHTML = "";

  plano.etapas.forEach(etapa => {
    const li = document.createElement("li");
    li.innerText = etapa;
    lista.appendChild(li);
  });

  // Meta baseada nas entradas
  metaMensal = rendaMensalBase * plano.porcentagem;

  document.getElementById("desafioMeta").innerText = metaMensal.toFixed(2);

  progresso = 0;

  if(metaMensal > 0){
    progresso = (valorGuardado / metaMensal) * 100;
  }

  if(progresso > 100) progresso = 100;

  document.getElementById("desafioProgresso").innerText = progresso.toFixed(0);
  document.getElementById("barraDesafio").style.width = progresso + "%";
}
  
function abrirTela(id){

  // üîπ Limpa campos da tela de entrada
  if(id === "telaEntrada"){
    document.getElementById("nomeClienteInput").value = "";
    document.getElementById("valorEntradaInput").value = "";
  }

  // üîπ Limpa campos da tela nova conta
  if(id === "telaNovaConta"){
    document.getElementById("nomeContaInput").value = "";
    document.getElementById("valorContaInput").value = "";
    document.getElementById("vencimentoContaInput").value = "";
  }

  // üîπ Limpa campos da tela sa√≠da
  if(id === "telaSaida"){
    document.getElementById("valorSaidaInput").value = "";
  }

  document.getElementById(id).classList.add("active");
}

function fecharTela(id){
  document.getElementById(id).classList.remove("active");
}

function criarDesafioPersonalizado(){

  const nome = document.getElementById("nomeDesafio").value;
  let nomeLower = nome.toLowerCase();

for (let palavra in mapaEmojis) {
  if (nomeLower.includes(palavra)) {
    emojiSelecionado = mapaEmojis[palavra];
    break;
  }
}
  const valor = parseFloat(document.getElementById("valorDesafio").value);
  const partes = parseInt(document.getElementById("partesDesafio").value);

  if(!nome || isNaN(valor) || isNaN(partes) || partes <= 0){
    alert("Preencha todos os campos corretamente.");
    return;
  }

  let novoDesafio = {
    nome: nome,
    valorTotal: valor,
    partes: partes,
    valorParcela: valor / partes,
    parcelasPagas: 0,
    emoji: emojiSelecionado
  };

  desafios.push(novoDesafio);

  // Limpa campos
  document.getElementById("nomeDesafio").value = "";
  document.getElementById("valorDesafio").value = "";
  document.getElementById("partesDesafio").value = "";

  emojiSelecionado = "üéØ";

  fecharTela("telaNovoDesafio");

  atualizarListaDesafios();
}
  function atualizarListaDesafios(){

  const container = document.getElementById("listaDesafios");
  container.innerHTML = "";

  desafios.forEach((desafio, index) => {

    let porcentagem = 0;

    if(desafio.partes > 0){
      porcentagem = (desafio.parcelasPagas / desafio.partes) * 100;
    }

    const item = document.createElement("div");
    item.style.marginBottom = "15px";
    item.style.padding = "12px";
    item.style.background = "rgba(255,255,255,0.08)";
    item.style.borderRadius = "8px";

    item.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong style="font-size:16px;">
            ${desafio.emoji} ${desafio.nome}
          </strong><br>
          ${moedaUsuario} ${desafio.valorTotal.toFixed(2)}
        </div>
        <button onclick="abrirDesafio(${index})"
          style="
            background:#00c896;
            border:none;
            padding:6px 10px;
            border-radius:6px;
            color:white;
            cursor:pointer;
          ">
          Abrir ‚Üí
        </button>
      </div>

      <div style="
        background:#333;
        height:8px;
        border-radius:5px;
        margin-top:10px;
      ">
        <div style="
          width:${porcentagem}%;
          height:8px;
          background:#00c896;
          border-radius:5px;
        "></div>
      </div>
    `;

    container.appendChild(item);

  });

}
 function abrirDesafio(index){

  desafioAtualIndex = index;
  const desafio = desafios[index];

  // Atualiza textos
  document.getElementById("tituloDetalhe").innerText =
    desafio.emoji + " " + desafio.nome;

  document.getElementById("valorTotalDetalhe").innerText =
    moedaUsuario + " " + desafio.valorTotal.toFixed(2);

  document.getElementById("valorParcelaDetalhe").innerText =
    moedaUsuario + " " + desafio.valorParcela.toFixed(2);

  // Desenha as parcelas
  atualizarParcelasVisuais();

  // Abre tela
  abrirTela("telaDetalheDesafio");
}
function atualizarParcelasVisuais(){

  const desafio = desafios[desafioAtualIndex];
  const area = document.getElementById("areaParcelas");

  area.innerHTML = "";

  for(let i = 0; i < desafio.partes; i++){

    const span = document.createElement("span");

    if(i < desafio.parcelasPagas){
      span.innerText = "üü¢";
    } else {
      span.innerText = desafio.emoji;
    }

    span.style.marginRight = "10px";

    area.appendChild(span);
  }

}
 function pagarParcela(){

  const desafio = desafios[desafioAtualIndex];

  if(desafio.parcelasPagas >= desafio.partes){
    alert("Todas as parcelas j√° foram pagas.");
    return;
  }

  // üî• Verifica se tem saldo suficiente
  if(saldo < desafio.valorParcela){
    alert("Saldo insuficiente para pagar esta parcela.");
    return;
  }

  // üí∏ Desconta do saldo
  saldo -= desafio.valorParcela;

  // üê∑ Adiciona na reserva
  valorGuardado += desafio.valorParcela;

  // Marca parcela como paga
  desafio.parcelasPagas++;

  // üîÑ Atualiza cards da Home
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza visual das parcelas
  atualizarParcelasVisuais();

  // Atualiza lista principal
  atualizarListaDesafios();

}
  function encerrarDesafio(){

  if(desafioAtualIndex === null) return;

  if(!confirm("Encerrar este desafio? As parcelas pagas continuar√£o na sua reserva.")){
    return;
  }

  // Remove da lista
  desafios.splice(desafioAtualIndex, 1);

  desafioAtualIndex = null;

  fecharTela("telaDetalheDesafio");
  atualizarListaDesafios();

}
  function confirmarRenda(){

  let valor = parseFloat(document.getElementById("rendaInput").value);
  moedaUsuario = document.getElementById("moedaSelect").value;
  // Atualiza saldo e reserva imediatamente
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);
  if(isNaN(valor) || valor <= 0){
    alert("Digite um valor v√°lido.");
    return;
  }

  rendaMensalBase = valor;

  // üî• Gera perfil se ainda n√£o estiver gerado
  if(!userProfile){
    generateProfile();
  }

  // üî• Calcula meta baseada no perfil
  const plano = planosPerfil[userProfile];

  if(plano){
    metaMensal = rendaMensalBase * plano.porcentagem;
  }

  gerarCategoriasBase();

  document.getElementById("setupRenda").classList.add("hidden");

  goToHome();
}
  function atualizarTelaCategorias(){

  const container = document.getElementById("listaCategorias");
  container.innerHTML = "";

  categorias.forEach((categoria, index) => {
    let totalCategoria = categoria.subcategorias.reduce(
    (acc, sub) => acc + sub.total, 0
    );
    let porcentagem = 0;

    if(categoria.piso > 0){
      porcentagem = (totalCategoria / categoria.piso) * 100;
    }

    let corBarra = "#00c896"; // verde padr√£o

    if(porcentagem >= 80 && porcentagem < 100){
      corBarra = "#f4b400"; // amarelo
  }
    else if(porcentagem >= 100){
      corBarra = "#ff4d4d"; // vermelho
  }

    const card = document.createElement("div");
    card.style.marginBottom = "20px";
    card.style.padding = "15px";
    card.style.background = "rgba(255,255,255,0.08)";
    card.style.borderRadius = "10px";

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <strong>${categoria.nome}</strong>
  <span>
    ${moedaUsuario} ${totalCategoria.toFixed(2)} /
    <span
     style="
       cursor:pointer;
       text-decoration:underline;
       font-weight:600;
    "
    title="Clique para editar o limite"
    onclick="editarPiso(${index})">
    ${moedaUsuario} ${categoria.piso.toFixed(2)} ‚úèÔ∏è
  </span>
</span>
      </div>

      <div style="
        background:#333;
        height:10px;
        border-radius:6px;
        margin-top:10px;
        overflow:hidden;
      ">
        <div style="
          width:${porcentagem}%;
          height:10px;
          background:${corBarra};
          transition:0.4s;
        "></div>
      </div>
    `;

    container.appendChild(card);

  });

}
  function gerarCategoriasBase(){

  categorias = []; // limpa se j√° existir algo

  if(!rendaMensalBase || !userProfile) return;

  let distribuicao = {};

  if(userProfile === "Cr√≠tico"){
    distribuicao = {
      "Essencial": 0.60,
      "Fixos": 0.25,
      "Lazer": 0.05,
      "Espor√°dicos": 0.05
    };
  }

  else if(userProfile === "Iniciante"){
    distribuicao = {
      "Essencial": 0.50,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "Espor√°dicos": 0.07
    };
  }

  else if(userProfile === "Intermedi√°rio"){
    distribuicao = {
      "Essencial": 0.40,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "Espor√°dicos": 0.10
    };
  }

  else if(userProfile === "Est√°vel"){
    distribuicao = {
      "Essencial": 0.35,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "Espor√°dicos": 0.10
    };
  }

  else { // Em Evolu√ß√£o
    distribuicao = {
      "Essencial": 0.45,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "Espor√°dicos": 0.10
    };
  }

  for (let nome in distribuicao){

  let pisoCalculado = rendaMensalBase * distribuicao[nome];

  let subcategoriasPadrao = [];

  if(nome === "Essencial"){
    subcategoriasPadrao = [
      { nome: "Mercado", total: 0 },
      { nome: "Farm√°cia", total: 0 }
    ];
  }

  else if(nome === "Fixos"){
    subcategoriasPadrao = [
      { nome: "Aluguel", total: 0 },
      { nome: "Luz", total: 0 },
      { nome: "√Ågua", total: 0 },
      { nome: "Internet", total: 0 }
    ];
  }

  else if(nome === "Lazer"){
    subcategoriasPadrao = [
      { nome: "Restaurante", total: 0 },
      { nome: "Cinema", total: 0 }
    ];
  }

  else if(nome === "Espor√°dicos"){
    subcategoriasPadrao = [
      { nome: "Roupas", total: 0 },
      { nome: "Manuten√ß√£o", total: 0 }
    ];
  }

  else{
    subcategoriasPadrao = [];
  }

  categorias.push({
    nome: nome,
    piso: pisoCalculado,
    subcategorias: subcategoriasPadrao
  });

}
}
 function abrirTelaSaida(){

  if(categorias.length === 0){
    alert("Nenhuma categoria criada.");
    return;
  }

  abrirTela("telaSaida");

  const selectCategoria = document.getElementById("selectCategoria");
  const selectSub = document.getElementById("selectSubcategoria");

  selectCategoria.innerHTML = "";
  selectSub.innerHTML = "";

  categorias.forEach(function(cat, index){
    let option = document.createElement("option");
    option.value = index;
    option.text = cat.nome;
    selectCategoria.appendChild(option);
  });

  atualizarSubcategorias();
}

function atualizarSubcategorias(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const selectSub = document.getElementById("selectSubcategoria");

  selectSub.innerHTML = "";

  categorias[indexCategoria].subcategorias.forEach(function(sub, i){
    let option = document.createElement("option");
    option.value = i;
    option.text = sub.nome;
    selectSub.appendChild(option);
  });
}

document.addEventListener("change", function(e){
  if(e.target.id === "selectCategoria"){
    atualizarSubcategorias();
  }
});

function confirmarSaida(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const indexSub = document.getElementById("selectSubcategoria").value;
  const valor = parseFloat(document.getElementById("valorSaidaInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  saldo -= valor;
  saidasTotal += valor;
  // üî• SISTEMA 10%
if(sistema10Ativo){
  pendenteSaidas += valor * 0.10;
}

  categorias[indexCategoria].subcategorias[indexSub].total += valor;
  // üî• Verificar limite da categoria
  // üî• Registrar no hist√≥rico
let agora = new Date();

historicoSaidas.push({
  data: agora.toLocaleDateString(),
  hora: agora.toLocaleTimeString(),
  categoria: categorias[indexCategoria].nome,
  subcategoria: categorias[indexCategoria].subcategorias[indexSub].nome,
  valor: valor
});

let categoria = categorias[indexCategoria];

let totalCategoria = categoria.subcategorias.reduce(function(acc, sub){
  return acc + sub.total;
}, 0);

let porcentagem = (totalCategoria / categoria.piso) * 100;

if(porcentagem >= 120){
  let excesso = totalCategoria - categoria.piso;
  alert("üö® Voc√™ ultrapassou o limite da categoria " 
        + categoria.nome + 
        " em " + moedaUsuario + " " + excesso.toFixed(2));
}

else if(porcentagem >= 100){
  alert("üö® Voc√™ atingiu o limite da categoria " 
        + categoria.nome);
}

else if(porcentagem >= 80){
  alert("‚ö†Ô∏è Aten√ß√£o: voc√™ est√° pr√≥ximo do limite da categoria " 
        + categoria.nome);
}

  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("saidaValor").innerText = moedaUsuario + " " + saidasTotal.toFixed(2);
  analisarSituacaoFinanceira();
  fecharTela("telaSaida");
  atualizarTelaCategorias();
}

 function adicionarSubcategoria(){

  const indexCategoria = document.getElementById("selectCategoria").value;

  let nome = prompt("Digite o nome da nova subcategoria:");

  if(!nome || nome.trim() === ""){
    alert("Nome inv√°lido.");
    return;
  }

  categorias[indexCategoria].subcategorias.push({
    nome: nome,
    total: 0
  });

  atualizarSubcategorias();
}

  function excluirSubcategoria(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const indexSub = document.getElementById("selectSubcategoria").value;

  let sub = categorias[indexCategoria].subcategorias[indexSub];

  if(!sub){
    alert("Nenhuma subcategoria selecionada.");
    return;
  }

  if(sub.total > 0){

    let confirmar = confirm(
      "Esta subcategoria possui " + moedaUsuario + " " + sub.total.toFixed(2)+ 
      " registrados.\n\nOs valores continuar√£o contabilizados no saldo e relat√≥rios.\n\nDeseja excluir mesmo assim?"
    );

    if(!confirmar) return;
  }

  categorias[indexCategoria].subcategorias.splice(indexSub, 1);

  atualizarSubcategorias();
}

  function confirmarEntrada(){
  console.log("confirmarEntrada foi chamada");
  const nome = document.getElementById("nomeClienteInput").value;
  const valor = parseFloat(document.getElementById("valorEntradaInput").value);

  if(!nome || isNaN(valor) || valor <= 0){
    alert("Preencha nome e valor corretamente.");
    return;
  }

  // Soma valores
  entradasTotal += valor;
  saldo += valor;
  // üî• SISTEMA 10%
if(sistema10Ativo){
  pendenteEntradas += valor * 0.10;
}
  // üî• Criar registro com data e m√™s
let agora = new Date();

let registroEntrada = {
  cliente: nome,
  valor: valor,
  data: agora.toLocaleDateString("pt-PT"),
  hora: agora.toLocaleTimeString("pt-PT"),
  mes: agora.getMonth() + 1,
  ano: agora.getFullYear()
};

historicoEntradas.push(registroEntrada);
  // üî• Atualiza meta baseada no perfil
  // Atualiza UI principal
  document.getElementById("entradaValor").innerText = moedaUsuario + " " + entradasTotal.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  if(!userProfile){
  generateProfile();
}
  // Atualiza barra da meta
  atualizarProgresso();

  // üî• Se tela de desafios estiver aberta, atualiza tamb√©m
  carregarPlanoDesafio();

  // Limpa campos
  document.getElementById("nomeClienteInput").value = "";
  document.getElementById("valorEntradaInput").value = "";
  adicionarNotificacao("sucesso", "Entrada registrada com sucesso!");
  analisarSituacaoFinanceira();
  fecharTela("telaEntrada");
  abrirAba("home");
  
}

 function gerarRelatorio(){

  let html = "";
  let mesSelecionado = document.getElementById("filtroMes").value;
  let categoriaSelecionada = document.getElementById("filtroCategoria").value;

  // üî• BLOCO D√çVIDA
  if(dividaAtual > 0){
    html += "<h3>D√≠vida Atual</h3>";
    html += "üí≥ " + moedaUsuario + " " + dividaAtual.toFixed(2) + "<br><br>";
  }

  // üî• BLOCO PERFIL + META

  let porcentagemMeta = 0;

  if(metaMensal > 0){
    porcentagemMeta = (valorGuardado / metaMensal) * 100;
  }

  if(porcentagemMeta > 100){
    porcentagemMeta = 100;
  }

  html += "<h3>Perfil Financeiro</h3>";
  html += "Perfil: " + userProfile + "<br>";
  html += "Meta do Perfil: " + moedaUsuario + " " + metaMensal.toFixed(2) + "<br>";
  html += "Guardado: " + moedaUsuario + " " + valorGuardado.toFixed(2) +
          " (" + porcentagemMeta.toFixed(0) + "%)<br><br>";

  html += "<h3>Resumo Geral</h3>";

  let totalSaidasFiltradas = 0;

  if(categoriaSelecionada === "todas"){
    totalSaidasFiltradas = saidasTotal;
  } else {

    totalSaidasFiltradas = historicoSaidas
      .filter(function(item){
        return item.categoria === categoriaSelecionada;
      })
      .reduce(function(acc, item){
        return acc + item.valor;
      }, 0);
  }

  html += "Saldo: " + moedaUsuario + " " + saldo.toFixed(2) + "<br>";
  html += "Entradas: " + moedaUsuario + " " + entradasTotal.toFixed(2) + "<br>";
  html += "Sa√≠das: " + moedaUsuario + " " + totalSaidasFiltradas.toFixed(2) + "<br>";
  html += "Reserva: " + moedaUsuario + " " + valorGuardado.toFixed(2) + "<br><br>";

  html += "<h3>Hist√≥rico de Entradas</h3>";

  let entradasFiltradas = historicoEntradas.filter(function(item){
    let passaMes = (mesSelecionado === "todos" || item.mes == mesSelecionado);
    return passaMes;
  });

  if(entradasFiltradas.length === 0){
    html += "Nenhuma entrada encontrada.<br>";
  } else {

    entradasFiltradas.forEach(function(item){

      html += item.data + " " + item.hora + " ‚Äî " +
              "Cliente: " + item.cliente +
              " ‚Äî " + moedaUsuario + " " + item.valor.toFixed(2) + "<br>";

    });

  }

  html += "<br>";
  html += "<h3>Categorias</h3>";

  let categoriasFiltradas = categorias.filter(function(cat){

    if(categoriaSelecionada === "todas"){
      return true;
    }

    return cat.nome === categoriaSelecionada;
  });

  categoriasFiltradas.forEach(function(cat){

    let total = cat.subcategorias.reduce(function(acc, sub){
      return acc + sub.total;
    }, 0);

    html += cat.nome + ": " + moedaUsuario + " " + total.toFixed(2) + "<br>";

  });

  html += "<br><h3>Hist√≥rico de Sa√≠das</h3>";

  if(historicoSaidas.length === 0){
    html += "Nenhuma sa√≠da registrada.<br>";
  } else {

    historicoSaidas.forEach(item => {

      html += `
        ${item.data} ${item.hora} ‚Äî
        ${item.categoria} > ${item.subcategoria}
        ‚Äî ${moedaUsuario} ${item.valor.toFixed(2)}<br>
      `;

    });

  }

  html += "<br><h3>Desafios</h3>";

  desafios.forEach(desafio => {

    let porcentagem = 0;

    if(desafio.partes > 0){
      porcentagem = (desafio.parcelasPagas / desafio.partes) * 100;
    }

    html += desafio.emoji + " " + desafio.nome +
      " ‚Äî " + porcentagem.toFixed(0) + "% conclu√≠do<br>";
  });

  document.getElementById("conteudoRelatorio").innerHTML = html;
}
  function preencherFiltrosRelatorio(){

  const selectMes = document.getElementById("filtroMes");
  const selectCategoria = document.getElementById("filtroCategoria");

  selectMes.innerHTML = '<option value="todos">Todos os Meses</option>';
  selectCategoria.innerHTML = '<option value="todas">Todas Categorias</option>';

  // Meses
  let meses = new Set();

  historicoEntradas.forEach(e => meses.add(e.mes));
  historicoSaidas.forEach(s => {
    let partes = s.data.split("/");
    meses.add(parseInt(partes[1]));
  });

  meses.forEach(m => {
    let option = document.createElement("option");
    option.value = m;
    option.text = "M√™s " + m;
    selectMes.appendChild(option);
  });

  // Categorias
  categorias.forEach(cat => {
    let option = document.createElement("option");
    option.value = cat.nome;
    option.text = cat.nome;
    selectCategoria.appendChild(option);
  });

}

 function editarPiso(index){

  let novoValor = prompt("Digite o novo limite para esta categoria:");

  if(novoValor === null) return;

  novoValor = parseFloat(novoValor);

  if(isNaN(novoValor) || novoValor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  categorias[index].piso = novoValor;

  atualizarTelaCategorias();
}
  function gerarPDF(){
  window.print();
}
  function pegarEmprestimo(){

  let valor = parseFloat(document.getElementById("valorEmprestimoInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  if(valor > valorGuardado){
    alert("Voc√™ n√£o tem reserva suficiente.");
    return;
  }

  // Sai da reserva
  valorGuardado -= valor;

  // Entra no saldo
  saldo += valor;

  // Aumenta d√≠vida
  dividaAtual += valor;

  // Atualiza interface principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza texto da d√≠vida
  document.getElementById("dividaAtualTexto").innerText = dividaAtual.toFixed(2);
  atualizarDividaHeader();
  // Limpa campo
  document.getElementById("valorEmprestimoInput").value = "";
  analisarSituacaoFinanceira();

}
  function pagarEmprestimo(){
  alert("Fun√ß√£o pagar chamada");
  let valor = parseFloat(document.getElementById("valorPagamentoInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor inv√°lido.");
    return;
  }

  if(valor > saldo){
    alert("Voc√™ n√£o tem saldo suficiente.");
    return;
  }

  if(valor > dividaAtual){
    alert("O valor √© maior que a d√≠vida atual.");
    return;
  }

  // Sai do saldo
  saldo -= valor;

  // Volta para reserva
  valorGuardado += valor;

  // Reduz d√≠vida
  dividaAtual -= valor;

  // Atualiza interface principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza texto da d√≠vida
  document.getElementById("dividaAtualTexto").innerText = dividaAtual.toFixed(2);
  atualizarDividaHeader();
  // Limpa campo
  document.getElementById("valorPagamentoInput").value = "";
  analisarSituacaoFinanceira();

}
  function atualizarDividaHeader(){

  console.log("Atualizando header. D√≠vida atual:", dividaAtual);

  if(dividaAtual > 0){

    document.getElementById("dividaHeader").style.display = "block";
    document.getElementById("dividaHeader").innerText =
       "üí≥ D√≠vida: " + moedaUsuario + " " + dividaAtual.toFixed(2);

  } else {

    document.getElementById("dividaHeader").style.display = "none";

  }

}
  function atualizarListaContas(){

  const container = document.getElementById("listaContas");
  container.innerHTML = "";

  if(contas.length === 0){
    container.innerHTML = "Nenhuma conta cadastrada.";
    return;
  }

  contas.forEach((conta, index) => {

    const div = document.createElement("div");

    div.style.background = "rgba(255,255,255,0.08)";
    div.style.padding = "15px";
    div.style.borderRadius = "10px";
    div.style.marginBottom = "15px";

    
  const hoje = new Date();
const vencimento = new Date(conta.vencimento);

const diffTime = vencimento - hoje;
const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

let statusTexto = "";
let corStatus = "#00c896";

if(diffDias < 0){
  statusTexto = "üî¥ Conta vencida";
  corStatus = "#ff4d4d";
}
else if(diffDias <= 3){
  statusTexto = "üü° Vence em " + diffDias + " dias";
  corStatus = "#f4b400";
}
else{
  statusTexto = "üü¢ Dentro do prazo";
}

div.innerHTML =
  "<strong>" + conta.nome + "</strong><br>" +
  "Valor: " + moedaUsuario + " " + conta.valor.toFixed(2) + "<br>" +
  "Vencimento: " + conta.vencimento + "<br>" +
  "<span style='color:" + corStatus + "; font-weight:600;'>" +
  statusTexto +
  "</span>" +
  "<br><br>" +
  "<button onclick='pagarConta(" + index + ")' " +
  "style='background:#00c896;border:none;padding:6px 10px;border-radius:6px;color:white;cursor:pointer;'>" +
  "‚úî Marcar como Paga</button>";
  container.appendChild(div);

  });

}

  function atualizarResumoContas(){

  const header = document.getElementById("contasResumo");

  if(!header) return;

  if(contas.length === 0){
    header.innerHTML = "üßæ Contas: üü¢ Nenhuma pendente";
    return;
  }

  let vencidas = 0;
  let vencendo = 0;

  const hoje = new Date();

  contas.forEach(conta => {

    if(conta.paga) return;

    const vencimento = new Date(conta.vencimento);
    const diffTime = vencimento - hoje;
    const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if(diffDias < 0){
      vencidas++;
    }
    else if(diffDias <= 3){
      vencendo++;
    }

  });

  if(vencidas > 0){
    header.innerHTML = "üßæ Contas: üî¥ " + vencidas + " vencida(s)";
  }
  else if(vencendo > 0){
    header.innerHTML = "üßæ Contas: üü° " + vencendo + " vencendo";
  }
  else{
    header.innerHTML = "üßæ Contas: üü¢ Nenhuma pendente";
  }

}
  function salvarConta(){

  const nome = document.getElementById("novaContaNome").value;
  const valor = parseFloat(document.getElementById("novaContaValor").value);
  const vencimento = document.getElementById("novaContaVencimento").value;

  if(!nome || isNaN(valor) || !vencimento){
    alert("Preencha todos os campos.");
    return;
  }

  contas.push({
    nome: nome,
    valor: valor,
    vencimento: vencimento,
    paga: false
  });

  document.getElementById("novaContaNome").value = "";
  document.getElementById("novaContaValor").value = "";
  document.getElementById("novaContaVencimento").value = "";

  fecharTela("telaNovaConta");
  atualizarListaContas();
  atualizarResumoContas();
}
 function salvarNovaConta(){

  const nome = document.getElementById("nomeContaInput").value;
  const valor = parseFloat(document.getElementById("valorContaInput").value);
  const vencimento = document.getElementById("vencimentoContaInput").value;

  if(!nome || isNaN(valor) || !vencimento){
    alert("Preencha todos os campos corretamente.");
    return;
  }

  contas.push({
    nome: nome,
    valor: valor,
    vencimento: vencimento,
    paga: false
  });

  alert("Conta adicionada com sucesso!");

  atualizarListaContas();
  atualizarResumoContas();

  fecharTela("telaNovaConta");

}
 function pagarConta(index){

  const conta = contas[index];

  if(conta.valor > saldo){
    alert("Saldo insuficiente para pagar esta conta.");
    return;
  }

  // üí∏ Baixa do saldo
  saldo -= conta.valor;
  saidasTotal += conta.valor;

  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("saidaValor").innerText = moedaUsuario + " " + saidasTotal.toFixed(2);

  // üìä Registra no hist√≥rico
  let agora = new Date();

  historicoSaidas.push({
    data: agora.toLocaleDateString("pt-PT"),
    hora: agora.toLocaleTimeString("pt-PT"),
    categoria: "Contas",
    subcategoria: conta.nome,
    valor: conta.valor
  });

  // üóë REMOVE COMPLETAMENTE DA LISTA
  contas.splice(index, 1);

  atualizarListaContas();
  atualizarResumoContas();
}
  function atualizarProgresso(){

  // Atualiza texto —Å—á–∏—Ç–∞ na Home
  document.getElementById("guardadoValor").innerText = valorGuardado.toFixed(2);
  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);
  document.getElementById("moedaMeta").innerText = moedaUsuario + " ";
  document.getElementById("moedaGuardado").innerText = moedaUsuario + " ";
  let porcentagem = 0;

  if(metaMensal > 0){
    porcentagem = (valorGuardado / metaMensal) * 100;
    if(porcentagem > 100){
      porcentagem = 100;
    }
  }

  document.getElementById("barraMeta").style.width = porcentagem + "%";
}
  function aplicarAjusteSaldo(){

  let valor = parseFloat(document.getElementById("ajusteSaldoInput").value);

  if(isNaN(valor) || valor === 0){
    alert("Digite um valor v√°lido.");
    return;
  }

  // Verifica se vai deixar saldo negativo
  if(saldo + valor < 0){
    alert("O ajuste deixaria o saldo negativo.");
    return;
  }

  // Aplica ajuste
  saldo += valor;

  // Atualiza card da Home
  document.getElementById("saldoValor").innerText =
    moedaUsuario + " " + saldo.toFixed(2);

  // Limpa campo
  document.getElementById("ajusteSaldoInput").value = "";

  alert("Saldo ajustado com sucesso!");

}
  function toggleSistema10(){

  const check = document.getElementById("toggleSistema10");

  sistema10Ativo = check.checked;

  if(sistema10Ativo){
    alert("Sistema 10% ativado.");
  } else {
    alert("Sistema 10% desativado.");
  }

}

  function atualizarSistema10Visual(){

  const bloco = document.getElementById("blocoSistema10");

  if(!bloco) return;

  if(sistema10Ativo){

    bloco.style.display = "block";

    document.getElementById("pendenteEntradasTexto").innerText =
      moedaUsuario + " " + pendenteEntradas.toFixed(2);

    document.getElementById("pendenteSaidasTexto").innerText =
      moedaUsuario + " " + pendenteSaidas.toFixed(2);

    let total = pendenteEntradas + pendenteSaidas;

    document.getElementById("pendenteTotalTexto").innerText =
      moedaUsuario + " " + total.toFixed(2);

  } else {

    bloco.style.display = "none";

  }

}
  function separarManual10(){

  let valor = parseFloat(document.getElementById("valorSepararManualInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Digite um valor v√°lido.");
    return;
  }

  let totalPendente = pendenteEntradas + pendenteSaidas;

  if(valor > totalPendente){
    alert("Voc√™ est√° tentando separar mais do que o acumulado.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  // üî• Move dinheiro do saldo para reserva
  saldo -= valor;
  valorGuardado += valor;

  // üî• Desconta proporcionalmente dos pendentes
  if(valor <= pendenteEntradas){
    pendenteEntradas -= valor;
  } else {
    let restante = valor - pendenteEntradas;
    pendenteEntradas = 0;
    pendenteSaidas -= restante;
  }

  if(pendenteSaidas < 0){
    pendenteSaidas = 0;
  }

  // üî• Atualiza interface
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  atualizarSistema10Visual();
  document.getElementById("valorSepararManualInput").value = "";
}
  function atualizarTelaSistema10(){

  document.getElementById("pendenteEntradasTexto").innerText =
    moedaUsuario + " " + pendenteEntradas.toFixed(2);

  document.getElementById("pendenteSaidasTexto").innerText =
    moedaUsuario + " " + pendenteSaidas.toFixed(2);

  document.getElementById("pendenteTotalTexto").innerText =
    moedaUsuario + " " + (pendenteEntradas + pendenteSaidas).toFixed(2);

}
  function adicionarNotificacao(tipo, mensagem){

  const agora = new Date();

  notificacoes.unshift({
    tipo: tipo,
    mensagem: mensagem,
    data: agora.toLocaleDateString("pt-PT"),
    hora: agora.toLocaleTimeString("pt-PT"),
    lida: false
  });

  notificacoesNaoLidas++;

  mostrarNotificacaoTemporaria(tipo, mensagem);
  falar(mensagem);
  atualizarIconeNotificacao();
}
  function mostrarNotificacaoTemporaria(tipo, mensagem){

  let cor = "#00c896"; // sucesso padr√£o

  if(tipo === "alerta") cor = "#f4b400";
  if(tipo === "erro") cor = "#ff4d4d";
  if(tipo === "info") cor = "#3b82f6";

  const div = document.createElement("div");

  div.style.position = "absolute";
  div.style.top = "30px";
  div.style.left = "50%";
  div.style.transform = "translateX(-50%)";
  div.style.width = "90%";
  div.style.background = cor;
  div.style.padding = "15px 20px";
  div.style.borderRadius = "10px";
  div.style.boxShadow = "0 4px 20px rgba(0,0,0,0.3)";
  div.style.zIndex = "999";
  div.style.color = "white";
  div.style.fontSize = "14px";
  div.style.maxWidth = "80%";
  div.style.textAlign = "center";
  div.innerText = mensagem;

  const app = document.querySelector(".app");
  app.appendChild(div);

  setTimeout(() => {
    div.remove();
  }, 4000);
}
  function atualizarIconeNotificacao(){

  const badge = document.getElementById("badgeNotificacao");

  if(!badge) return;

  if(notificacoesNaoLidas > 0){
    badge.style.display = "inline-block";
    badge.innerText = notificacoesNaoLidas;
  } else {
    badge.style.display = "none";
  }
}
  function falar(texto){

  if(!vozAtivada) return;

  if(!('speechSynthesis' in window)) return;

  const mensagem = new SpeechSynthesisUtterance(texto);

  mensagem.lang = "pt-PT";
  mensagem.rate = 0.95;   // levemente mais suave
  mensagem.pitch = 1.05;  // tom mais amig√°vel
  mensagem.volume = 1;

  // Evita sobreposi√ß√£o
  speechSynthesis.cancel();

  speechSynthesis.speak(mensagem);
}
  function calcularEstadoMentor(){

  // üî¥ RISCO
  if(saldo <= 0){
    return "risco";
  }

  if(saidasTotal > entradasTotal && entradasTotal > 0){
    return "risco";
  }

  // üü° ATEN√á√ÉO
  if(entradasTotal > 0 && saidasTotal >= entradasTotal * 0.8){
    return "atencao";
  }

  if(metaMensal > 0 && valorGuardado < metaMensal * 0.3){
    return "atencao";
  }

  // üü¢ CRESCIMENTO
  if(
    entradasTotal > saidasTotal &&
    valorGuardado >= metaMensal * 0.5
  ){
    return "crescimento";
  }

  // ‚ö™ EST√ÅVEL (padr√£o)
  return "estavel";
}
  const blocosMentor = {

  crescimento: {
    observacao: [
      "Seu fluxo financeiro est√° positivo.",
      "Suas entradas est√£o superando suas sa√≠das.",
      "Sua reserva est√° evoluindo de forma consistente."
    ],
    interpretacao: [
      "Isso demonstra disciplina nas suas decis√µes.",
      "Seu comportamento est√° alinhado com crescimento.",
      "Voc√™ est√° fortalecendo sua estrutura financeira."
    ],
    orientacao: [
      "Continue mantendo esse padr√£o.",
      "Se sustentar esse ritmo, sua meta ser√° alcan√ßada mais r√°pido.",
      "Esse √© o tipo de consist√™ncia que gera estabilidade."
    ]
  },

  estavel: {
    observacao: [
      "Sua situa√ß√£o financeira est√° est√°vel no momento.",
      "N√£o h√° sinais cr√≠ticos no seu fluxo atual.",
      "Seu padr√£o est√° equilibrado."
    ],
    interpretacao: [
      "Isso indica controle, mas ainda h√° espa√ßo para evolu√ß√£o.",
      "Voc√™ est√° mantendo sua estrutura.",
      "A estabilidade √© positiva, mas crescimento exige inten√ß√£o."
    ],
    orientacao: [
      "Talvez seja hora de buscar pequena otimiza√ß√£o.",
      "Revisar categorias pode ajudar a evoluir.",
      "Um pequeno ajuste pode acelerar seus resultados."
    ]
  },

  atencao: {
    observacao: [
      "Seus gastos est√£o consumindo grande parte das suas entradas.",
      "Sua margem de seguran√ßa est√° diminuindo.",
      "Seu n√≠vel de reserva est√° abaixo do ideal."
    ],
    interpretacao: [
      "Isso come√ßa a pressionar sua estrutura financeira.",
      "Seu comportamento recente exige mais cautela.",
      "H√° sinais de alerta no seu padr√£o."
    ],
    orientacao: [
      "Recomendo revisar despesas vari√°veis.",
      "Talvez seja hora de ajustar prioridades.",
      "Um controle mais r√≠gido esta semana pode evitar problemas."
    ]
  },

  risco: {
    observacao: [
      "Seu saldo entrou em zona cr√≠tica.",
      "Suas sa√≠das est√£o superando suas entradas.",
      "Sua estrutura financeira est√° fragilizada."
    ],
    interpretacao: [
      "Isso compromete sua estabilidade.",
      "Seu padr√£o atual n√£o √© sustent√°vel.",
      "A margem de seguran√ßa foi reduzida."
    ],
    orientacao: [
      "√â essencial reduzir gastos imediatamente.",
      "Reorganize suas prioridades agora.",
      "Ajustes r√°pidos podem evitar consequ√™ncias maiores."
    ]
  }

};
  function escolherAleatorio(lista){
  return lista[Math.floor(Math.random() * lista.length)];
}
 function analisarSituacaoFinanceira(forcar = false){

  let novoEstado = calcularEstadoMentor();

  // Se n√£o for for√ßado e o estado n√£o mudou, n√£o fala
  if(!forcar && novoEstado === estadoMentorAtual){
    return;
  }

  let blocos = blocosMentor[novoEstado];

  if(!blocos) return;

  let observacao = escolherAleatorio(blocos.observacao);
  let interpretacao = escolherAleatorio(blocos.interpretacao);
  let orientacao = escolherAleatorio(blocos.orientacao);

  let mensagem = observacao + " " + interpretacao + " " + orientacao;

  estadoMentorAtual = novoEstado;

  mostrarMensagemMentor(mensagem);
}
 function mostrarMensagemMentor(texto){

  const banner = document.getElementById("mentorBanner");

  if(!banner) return;

  banner.innerText = texto;
  banner.style.display = "block";

  if ('speechSynthesis' in window) {
    const fala = new SpeechSynthesisUtterance(texto);
    fala.lang = 'pt-PT';
    speechSynthesis.speak(fala);
  }

  setTimeout(() => {
    banner.style.display = "none";
  }, 8000);
}
</script>

</body>
</html>


