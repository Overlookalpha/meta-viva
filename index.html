







<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f2027">
<title>TESTE 999</title>
<style>

body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  display:flex;
  justify-content:center;
  height:100vh;
  overflow:hidden;
}
.app{
  width:100%;
  max-width:500px;
  height:100vh;
  padding:12px;
  box-sizing:border-box;
  position:relative;
  overflow:hidden;
}

.container{
  width:90%;
  max-width:500px;
  text-align:center;
  margin:0 auto;
}

h1{
  font-size:32px;
  margin-bottom:8px;
}

h2{
  margin-top:20px;
}

button{
  padding:12px 25px;
  border:none;
  border-radius:8px;
  margin-top:20px;
  cursor:pointer;
  font-size:16px;
}
.btnAcao{
  padding:10px 15px;
  font-size:15px;
  height:55px;
}

.primary{
  background:#00c896;
  color:white;
}

.secondary{
  background:#444;
  color:white;
  margin-left:10px;
}

.hidden{
  display:none;
}

.optionItem{
  display:block;
  margin:10px 0;
  text-align:left;
  background:rgba(255,255,255,0.1);
  padding:10px;
  border-radius:6px;
}

#progressText{
  font-size:14px;
  opacity:0.7;
}
/* PADRÃƒO MENU LATERAL */

.menuBtn {
    background: none;
    border: none;

    width: 40px;
    height: 40px;

    display: flex;
    align-items: center;
    justify-content: center;

    font-size: 45px;
}

.menuBtn:hover{
  background:rgba(255,255,255,0.15);
}

.menuBtn:hover{
  background:rgba(255,255,255,0.15);
}

.cardResumo{
  background:rgba(255,255,255,0.1);
  padding:12px;              /* antes era 25px */
  border-radius:12px;
  transition:0.2s;
  min-height:115px;          /* controla altura */
  display:flex;
  flex-direction:column;
  justify-content:center;
}

.cardResumo:hover{
  background:rgba(255,255,255,0.15);
}

.btnAcao{
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:14px;
  cursor:pointer;
}

.btnEntrada{
  background:#00c896;
  color:white;
}

.btnSaida{
  background:#ff3b30;
  color:white;
}
/* TELAS QUE ABREM POR CIMA */

.screen{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100vh;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  padding:20px;
  box-sizing:border-box;
  display:none;
  z-index:10;
  overflow-y:auto;
}

.screen.active{
  display:block;
}
  .fade-out {
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.5s ease;
}
  @media (max-width:768px){
  .cardResumo{
    padding:12px;
    min-height:95px;
  }
}
 @media (max-width:768px){

  #home > div{
    flex-direction:row !important;
  }

  #home > div > div:first-child{
    width:60px !important;
  }

  #home > div > div:last-child{
    flex:1 !important;
  }

}
  .tela{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
</style>
</head>

<body>

<div class="app">

<!-- LANDING -->
<div id="landing" style="position:relative;">

  <h1 style="
      font-size:80px;
      margin-bottom:15px;
      letter-spacing:3px;
      font-weight:800;
  ">
    Meta Viva
  </h1>

  <p style="
      font-size:22px;
      margin-bottom:10px;
      font-weight:300;
  ">
    Transforme seus sonhos em metas alcanÃ§Ã¡veis.
  </p>

  <p style="
      font-size:16px;
      opacity:0.85;
      max-width:420px;
      margin:0 auto 35px auto;
      line-height:1.5;
  ">
    Planeje sua vida financeira, crie objetivos reais,
    acompanhe sua evoluÃ§Ã£o e conquiste estabilidade
    com clareza e direÃ§Ã£o.
  </p>

  <button class="primary"
      onclick="start()"
      style="
        font-size:18px;
        padding:16px 32px;
        border-radius:10px;
        box-shadow:0 4px 20px rgba(0,0,0,0.3);
      ">
      Criar Meu Plano Gratuito
  </button>

  <div style="
      position:absolute;
      bottom:-80px;
      left:0;
      right:0;
      font-size:12px;
      opacity:0.5;
  ">
      Produzido por <strong>Overlock</strong> (IsaÃ­as Rodrigues)
  </div>

</div>
<!-- QUIZ -->
<div id="quiz" class="hidden">

  <div id="progressText"></div>
  <h2 id="questionText"></h2>
  <div id="options"></div>

  <button class="primary" id="nextBtn" onclick="nextQuestion()">PrÃ³ximo</button>
  <button class="secondary" onclick="previousQuestion()">Anterior</button>

</div>

<!-- RESULTADO -->
<div id="result" class="hidden">

  <h1 style="font-size:42px; margin-bottom:10px;">
    Seu Plano EstÃ¡ Pronto ğŸ¯
  </h1>

  <p style="font-size:20px; opacity:0.9; margin-bottom:20px;">
    Analisamos suas respostas e criamos uma estratÃ©gia personalizada
    para transformar sua situaÃ§Ã£o financeira passo a passo.
  </p>

  <div style="margin-top:30px; font-size:18px; line-height:1.6; opacity:0.85;">
    âœ” OrganizaÃ§Ã£o financeira clara<br>
    âœ” MÃ©todo de economia adaptado ao seu perfil<br>
    âœ” Plano para sair da instabilidade<br>
    âœ” EstratÃ©gia de crescimento consistente
  </div>
<div id="profileResult" style="margin-top:20px; font-size:18px;"></div>

 <button class="primary"
        style="margin-top:35px; font-size:18px; padding:14px 30px;"
        onclick="goToLogin()">
  Ir para Meu Painel
</button>

</div>

<!-- LOGIN -->
<div id="login" class="hidden">

  <h2>Crie sua conta para acessar seu painel</h2>

  <input type="text" id="name" placeholder="Seu nome" style="width:100%; padding:10px; margin-top:15px; border-radius:6px; border:none;">

  <input type="email" id="email" placeholder="Seu e-mail" style="width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none;">

  <input type="password" id="password" placeholder="Sua senha" style="width:100%; padding:10px; margin-top:10px; border-radius:6px; border:none;">

  <button class="primary" style="margin-top:20px;" onclick="createAccount()">
    Criar Conta e Acessar Painel
  </button>

</div>

<!-- SETUP RENDA -->
<div id="setupRenda" class="hidden">

  <h2>Defina sua renda mensal base</h2>

  <p style="opacity:0.8; font-size:14px; margin-top:10px;">
    Essa informaÃ§Ã£o serÃ¡ usada para montar sua estrutura financeira.
  </p>

  <input 
    type="number" 
    id="rendaInput" 
    placeholder="Digite sua renda mensal"
    style="width:100%; padding:10px; margin-top:15px; border-radius:6px; border:none;"
  >
  <p style="margin-top:15px;">Qual moeda vocÃª utiliza?</p>

<select id="moedaSelect"
  style="width:100%; padding:10px; border-radius:6px; border:none; margin-top:5px;">
  
  <option value="â‚¬">Euro (â‚¬)</option>
  <option value="R$">Real (R$)</option>
  <option value="$">DÃ³lar ($)</option>
  <option value="Â£">Libra (Â£)</option>

</select>

  <button 
    class="primary" 
    style="margin-top:20px;"
    onclick="confirmarRenda()">
    Confirmar e Montar Estrutura
  </button>

</div>


<!-- HOME -->
<div id="home" class="hidden" style="margin-top:40px;">

  <!-- ğŸ”” BANNER DO MENTOR (fica acima de tudo) -->
  <div id="mentorBanner" 
       style="display:none;
              background:#111;
              padding:15px;
              border-radius:8px;
              margin-bottom:15px;
              font-size:14px;">
  </div>

  <div style="
    width:100%;
    display:flex;
    gap:20px;
    align-items:flex-start;
  ">
    <!-- COLUNA 1 - MENU -->
    <div style="width:30%;">

  <div style="display:flex; flex-direction:column; gap:10px;">

  <button class="menuBtn"
onclick="abrirTela('telaHome')">
ğŸ 
</button>

<button class="menuBtn"
onclick="abrirTela('telaDesafios'); carregarPlanoDesafio();">
ğŸ¯
</button>

<button class="menuBtn" onclick="abrirTela('telaCategorias'); setTimeout(atualizarTelaCategorias, 10);">ğŸ“

<button class="menuBtn"
onclick="abrirTela('telaRelatorio'); preencherFiltrosRelatorio(); gerarRelatorio();">
ğŸ“Š
</button>

<button class="menuBtn"
onclick="abrirAba('reserva')">
ğŸ’°
</button>

<button class="menuBtn"
onclick="abrirAba('emprestimo')">
ğŸ¦
</button>

<button class="menuBtn"
onclick="abrirAba('contas')">
ğŸ§¾
</button>

<button class="menuBtn"
onclick="abrirAba('configuracoes')">
âš™ï¸
</button>

  </div>

</div>
    <!-- COLUNA 2 - CONTEÃšDO -->
    <div style="width:60%;">

     <!-- PERFIL -->
<div style="
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
">

  <!-- BLOCO ESQUERDA (foto + infos) -->
  <div style="display:flex; align-items:center; gap:15px;">

   <!-- FOTO -->
<img id="fotoPerfil"
    src="https://via.placeholder.com/60"
    style="
        width:40px;
        height:40px;
        border-radius:50%;
        object-fit:cover;
        border:2px solid #00c896;
        position:relative;
        top:-30px;
    ">
   <input type="file"
       id="inputFoto"
       accept="image/*"
       style="display:none">
    <!-- INFOS -->
    <div>
     <h3 id="nomeUsuario"
     style="margin:0; font-size:14px; cursor:pointer;">
     Nome do UsuÃ¡rio
     </h3>
      <input type="text"
       id="inputNome"
       style="display:none; font-size:14px; padding:2px; border-radius:4px; border:none;">

      <p id="perfilTipo" style="margin:0; font-size:10px; opacity:0.7;">
        Perfil: â€”
      </p>

      <p id="dividaHeader" style="margin:0; font-size:10px; color:#ff6b6b; display:none;">
        ğŸ’³ DÃ­vida: 0
      </p>

      <p id="contasResumo"
    onclick="abrirAba('contas')"
    style="
        margin:0;
        font-size:10px;
        cursor:pointer;
        position:relative;
        left:-50px;
    ">
    ğŸ“‹ Contas: ğŸŸ¢ Nenhuma pendente
   </p>
    </div>

  </div>

  <!-- BLOCO DIREITA (aÃ§Ãµes) -->
  <div style="display:flex; gap:12px;">

    <!-- ğŸ§  MENTOR -->
  <button onclick="analisarSituacaoFinanceira(true)"
  style="
    background:transparent !important;
    border:none;
    cursor:pointer;
    font-size:30px;
    padding:0;
  ">
  ğŸ§ 
</button>
    <!-- ğŸ”” NOTIFICAÃ‡ÃƒO -->
    <div style="position:relative;">
  <button onclick="abrirTela('telaNotificacoes')"
    style="
      background:transparent !important;
      border:none;
      cursor:pointer;
      font-size:18px;
      padding:0;
      position:relative;
      top:-40px;
    ">
    ğŸ””
  </button>

  <span id="badgeNotificacao"
    style="
      position:absolute;
      top:-4px;
      right:-4px;
      background:#ff3b30;
      color:white;
      font-size:11px;
      padding:3px 6px;
      border-radius:12px;
      display:none;
    ">
  </span>
</div>
</div>
</div>
      <!-- RESUMO -->
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:30px;">

        <div class="cardResumo">
          <p>Saldo</p>
          <h3 id="saldoValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>Reserva</p>
          <h3 id="reservaValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>Entradas</p>
          <h3 id="entradaValor">0</h3>
        </div>

        <div class="cardResumo">
          <p>SaÃ­das</p>
          <h3 id="saidaValor">0</h3>
        </div>

      </div>

      <!-- BOTÃ•ES -->
      
      <!-- META MENSAL -->
<div style="margin-top:25px;">

  <p style="margin:5px 0; font-size:14px; opacity:0.8;">
    Meta do mÃªs: <span id="moedaMeta"></span><span id="metaValor">0</span>
  </p>

  <div style="background:#333; border-radius:10px; height:18px; overflow:hidden;">
    <div id="barraMeta" style="
      height:18px;
      width:0%;
      background:#00c896;
      transition:0.4s;
    "></div>
  </div>

  <p style="margin-top:5px; font-size:13px; opacity:0.7;">
    Guardado: <span id="moedaGuardado"></span><span id="guardadoValor">0</span>
  </p>
  </div>
  <!-- BOTÃ•ES -->
<div style="display:flex; gap:15px; margin-top:15px;">

  <button class="btnAcao btnEntrada" style="flex:1;" onclick="abrirTela('telaEntrada')">
    + Entrada
  </button>

  <button class="btnAcao btnSaida" style="flex:1;" onclick="abrirTelaSaida()">
  - SaÃ­da
</button>
 </div>

    </div>

  </div>

</div>
<!-- DESAFIOS -->
<div id="desafios" class="hidden">
  <h2>Desafios</h2>
</div>

<!-- NOVO DESAFIO -->
<div id="novoDesafio" class="hidden">
  <h2>Criar Novo Desafio</h2>
</div>

<!-- CATEGORIAS -->
<!-- TELA CATEGORIAS -->
<div id="telaCategorias" class="screen">

  <button onclick="fecharTela('telaCategorias')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    â† Voltar
  </button>

  <h2 style="margin-top:0;">ğŸ—‚ï¸ Categorias</h2>

  <div id="listaCategorias" style="margin-top:20px;"></div>

</div>
<!-- TELA ENTRADA -->
<div id="telaEntrada" class="screen">

  <button onclick="fecharTela('telaEntrada')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2>+ Registrar Entrada</h2>

  <p>Nome do Cliente:</p>
  <input type="text" id="nomeClienteInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorEntradaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="confirmarEntrada()"
    style="margin-top:20px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Confirmar Entrada
  </button>

</div>
<!-- TELA SAÃDA -->
<div id="telaSaida" class="screen">

  <button onclick="fecharTela('telaSaida')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2>- Registrar SaÃ­da</h2>

  <p>Categoria:</p>
  <select id="selectCategoria" style="width:100%;padding:8px;border-radius:6px;border:none;"></select>

  <p style="margin-top:15px;">Subcategoria:</p>
  <select id="selectSubcategoria" style="width:100%;padding:8px;border-radius:6px;border:none;"></select>

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorSaidaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="confirmarSaida()"
    style="margin-top:20px;background:#ff4d4d;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Confirmar SaÃ­da
  </button>
  
  <div style="display:flex; gap:10px; margin-top:25px;">

  <button
    onclick="adicionarSubcategoria()"
    style="flex:1;background:#00c896;border:none;padding:10px;border-radius:8px;color:white;cursor:pointer;">
    â• Adicionar Subcategoria
  </button>

  <button
    onclick="excluirSubcategoria()"
    style="flex:1;background:#ff4d4d;border:none;padding:10px;border-radius:8px;color:white;cursor:pointer;">
    ğŸ—‘ï¸ Excluir Subcategoria
  </button>

</div>

</div>
  
<!-- RELATORIOS -->
<div id="relatorios" class="hidden">
  <h2>RelatÃ³rios</h2>
</div>

<!-- RESERVA -->
<!-- RESERVA -->
<div id="reserva" class="hidden"
     style="
        position: fixed;
        inset: 0;
        background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
        overflow-y: auto;
        padding: 5px;
        z-index: 1000;
     ">
  <h2>ğŸ’° Reserva Emergencial</h2>
  <button onclick="abrirAba('home')"
        style="background:none;
               border:none;
               color:white;
               font-size:16px;
               margin-bottom:20px;
               cursor:pointer;">
  â† Voltar
</button>

  <p style="margin-top:10px;">
    Meta do mÃªs: <span id="reservaMetaTexto">0</span>
  </p>

  <p>
    Guardado atÃ© agora: <span id="reservaGuardadoTexto">0</span>
  </p>

  <p>
    Falta: <span id="reservaFaltaTexto">0</span>
  </p>

  <!-- ğŸ”¹ BLOCO GUARDAR NORMAL (perfil) -->
  <div style="margin-top:20px;">
    <input 
      type="number" 
      id="valorGuardarInput" 
      placeholder="Digite valor para guardar"
      style="width:100%; padding:10px; border-radius:6px; border:none;">
  </div>

  <button class="primary" style="margin-top:15px;" onclick="guardarNaReserva()">
    Guardar Valor
  </button>

  <!-- ğŸ”¹ BLOCO SISTEMA 10% -->
  <div id="blocoSistema10" style="margin-top:25px; display:none;">

    <hr style="opacity:0.2; margin-bottom:20px;">

    <h3>ğŸ“Š SeparaÃ§Ã£o 10%</h3>

    <p>
      ğŸ“¥ 10% das Entradas: 
      <span id="pendenteEntradasTexto">0.00</span>
    </p>

    <p>
      ğŸ“¤ 10% das SaÃ­das: 
      <span id="pendenteSaidasTexto">0.00</span>
    </p>

    <p>
      <strong>Total a Separar: 
        <span id="pendenteTotalTexto">0.00</span>
      </strong>
    </p>

    <div style="margin-top:15px;">
      <input 
        type="number" 
        id="valorSepararManualInput"
        placeholder="Quanto vocÃª quer separar agora"
        style="width:100%; padding:10px; border-radius:6px; border:none;">
    </div>

    <button class="primary" style="margin-top:10px;" onclick="separarManual10()">
      Separar Agora
    </button>

  </div>

</div>

  <!-- TELA HOME -->
<div id="telaHome" class="screen">

  <button onclick="fecharTela('telaHome')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2>ğŸ  Painel Principal</h2>

 <div id="painelDiagnostico"
     style="
       background: rgba(255,255,255,0.08);
       padding: 18px;
       border-radius: 12px;
       margin-top: 20px;
       font-size: 14px;
       line-height: 1.6;
     ">

  <div style="font-weight:600; margin-bottom:10px; opacity:0.7;">
    ğŸ§  RAIO-X FINANCEIRO
  </div>

  <div id="conteudoDiagnostico">
    Analisando suas movimentaÃ§Ãµes...
  </div>

</div>
</div>

<!-- EMPRESTIMO -->
<div id="emprestimo" class="hidden"
     style="
        position: fixed;
        inset: 0;
        background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
        overflow-y: auto;
        padding: 20px;
        z-index: 1000;
     ">

  <h2>ğŸ¦ EmprÃ©stimo Interno</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <p>DÃ­vida Atual: <span id="dividaAtualTexto">0.00</span></p>

  <p style="margin-top:20px;">Valor para pegar emprestado:</p>
  <input type="number" id="valorEmprestimoInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="pegarEmprestimo()"
    style="margin-top:15px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Pegar EmprÃ©stimo
  </button>

  <p style="margin-top:30px;">Valor para pagar:</p>
  <input type="number" id="valorPagamentoInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <button onclick="pagarEmprestimo()"
    style="margin-top:15px;background:#ff4d4d;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Pagar EmprÃ©stimo
  </button>
  <hr style="margin:30px 0; opacity:0.2;">

<h3>ğŸ¦ Sacar da Reserva</h3>

<p>Valor para sacar:</p>
<input type="number" id="valorSaqueReservaInput"
  style="width:100%;padding:8px;border-radius:6px;border:none;">

<p style="margin-top:15px;">Motivo:</p>
<select id="motivoSaqueSelect"
  style="width:100%;padding:8px;border-radius:6px;border:none;">
  <option value="investimento">ğŸ“ˆ Investimento</option>
  <option value="bem">ğŸ› Compra de Bem</option>
  <option value="planejado">ğŸ’¼ Uso Planejado</option>
</select>

<button onclick="sacarDaReserva()"
  style="margin-top:15px;background:#3b82f6;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
  Sacar da Reserva
</button>

</div>

<!-- CONTAS A PAGAR -->
<div id="contas" class="hidden">

  <h2>ğŸ§¾ Contas a Pagar</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>
  <button 
  onclick="abrirTela('telaNovaConta')" 
  style="
    margin-bottom:15px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;">
  â• Nova Conta
</button>
  <div id="listaContas"></div>

</div>

<!-- CONFIGURACOES -->
<div id="configuracoes" class="hidden">

  <h2>âš™ï¸ ConfiguraÃ§Ãµes</h2>

  <button onclick="abrirAba('home')"
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>
  <div style="margin-top:20px;">
  <label style="display:flex;align-items:center;gap:8px;font-size:14px;">
    <input type="checkbox" id="mutarEvellyn">
    Mutar Evellyn ğŸ”‡
  </label>
</div>

  <h3 style="margin-top:20px;">ğŸ”§ Ajuste Manual de Saldo</h3>

  <p style="opacity:0.8; font-size:14px;">
    Use valores positivos para adicionar e negativos para remover.
  </p>

  <input 
    type="number" 
    id="ajusteSaldoInput"
    placeholder="Ex: 200 ou -150"
    style="width:100%; padding:10px; border-radius:6px; border:none; margin-top:10px;"
  >

  <button class="primary" style="margin-top:15px;" onclick="aplicarAjusteSaldo()">
    Aplicar Ajuste
  </button>
  <hr style="margin:30px 0; opacity:0.2;">

<h3>ğŸ“Š Sistema de SeparaÃ§Ã£o 10%</h3>

<label style="display:flex; align-items:center; gap:10px; margin-top:10px; cursor:pointer;">
  <input type="checkbox" id="toggleSistema10" onchange="toggleSistema10()">
  Ativar separaÃ§Ã£o automÃ¡tica de 10% (Entradas + SaÃ­das)
</label>

</div>

<!-- TELA DESAFIOS (NOVA TELA) -->
<div id="telaDesafios" class="screen">

  <button onclick="fecharTela('telaDesafios')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    â† Voltar
  </button>

  <h2 style=";">ğŸ¯ Desafios</h2>
 <button 
  onclick="abrirTela('telaNovoDesafio')"
  style="
    margin-top:15px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;
  ">
  â• Criar Novo Desafio
</button>

  <div style="margin-top:20px; text-align:left;">
  
  <div id="listaDesafios" style="margin-top:20px;"></div>
  <h3 id="tituloPlano"></h3>

  <ul id="etapasPlano" style="margin-top:15px; line-height:1.6;"></ul>

  <div style="margin-top:20px;">
    <p>Meta atual: <span id="desafioMeta">0</span></p>
    <p>Progresso: <span id="desafioProgresso">0</span>%</p>
  <div style="background:#333; border-radius:10px; height:18px; overflow:hidden; margin-top:10px;">
  <div id="barraDesafio" style="
    height:18px;
    width:0%;
    background:#00c896;
    transition:0.4s;
  "></div>
  </div>

</div>
</div>

 <!-- TELA NOVO DESAFIO -->
<div id="telaNovoDesafio" class="screen">

  <button onclick="fecharTela('telaNovoDesafio')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;
  ">
    â† Voltar
  </button>

  <h2 style="margin-top:0;">âœ¨ Criar Novo Desafio</h2>

  <div style="margin-top:20px; text-align:left;">

    <p>Nome do desafio:</p>
    <input type="text" id="nomeDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Valor total:</p>
    <input type="number" id="valorDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Dividir em quantas partes?</p>
    <input type="number" id="partesDesafio" 
      style="width:100%; padding:8px; border-radius:6px; border:none;">

    <p style="margin-top:15px;">Escolha um emoji:</p>

  <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
  

    <button onclick="criarDesafioPersonalizado()" 
      style="
        margin-top:20px;
        background:#00c896;
        border:none;
        padding:10px 15px;
        border-radius:8px;
        color:white;
        cursor:pointer;
      ">
      Criar Desafio<div style="display:flex; gap:15px; flex-wrap:wrap; margin-top:10px;">

<button type="button" onclick="selecionarEmoji('âœˆï¸')" style="font-size:40px; background:none; border:none; cursor:pointer;">âœˆï¸</button>

<button type="button" onclick="selecionarEmoji('ğŸ“±')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ“±</button>

<button type="button" onclick="selecionarEmoji('ğŸ’»')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ’»</button>

<button type="button" onclick="selecionarEmoji('ğŸš—')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸš—</button>

<button type="button" onclick="selecionarEmoji('ğŸ')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ</button>

<button type="button" onclick="selecionarEmoji('ğŸ·')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ·</button>

<button type="button" onclick="selecionarEmoji('ğŸ‚')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ‚</button>

<button type="button" onclick="selecionarEmoji('ğŸ’°')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ’°</button>

<button type="button" onclick="selecionarEmoji('ğŸ“¦')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ“¦</button>

<button type="button" onclick="selecionarEmoji('ğŸ¯')" style="font-size:40px; background:none; border:none; cursor:pointer;">ğŸ¯</button>

</div>
    </button>

  </div>

</div>

<!-- TELA DETALHE DESAFIO -->
<div id="telaDetalheDesafio" class="screen">

  <button onclick="fecharTela('telaDetalheDesafio')" style="
    background:none;
    border:none;
    color:white;
    font-size:16px;
    margin-bottom:20px;
    cursor:pointer;">
    â† Voltar
  </button>

  <h2 id="tituloDetalhe"></h2>

  <p>Total: <span id="valorTotalDetalhe"></span></p>
  <p>Parcela: <span id="valorParcelaDetalhe"></span></p>

  <div id="areaParcelas" style="margin-top:20px; font-size:28px;"></div>

  <button onclick="pagarParcela()" style="
    margin-top:25px;
    background:#00c896;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    color:white;
    cursor:pointer;">
    ğŸ’¸ Pagar Parcela
  </button>
  <button onclick="encerrarDesafio()" style="
  margin-top:15px;
  background:#444;
  border:none;
  padding:10px 15px;
  border-radius:8px;
  color:white;
  cursor:pointer;">
  âœ” Encerrar Desafio
</button>

</div>
  </div>

<!-- TELA RELATÃ“RIO -->
<div id="telaRelatorio" class="screen">

  <button onclick="fecharTela('telaRelatorio')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2 style="margin-top:0;">ğŸ“Š RelatÃ³rio Financeiro</h2>
  <div style="margin:15px 0; display:flex; gap:10px; flex-wrap:wrap;">

  <select id="filtroMes" style="padding:6px;border-radius:6px;border:none;">
    <option value="todos">Todos os Meses</option>
  </select>

  <select id="filtroCategoria" style="padding:6px;border-radius:6px;border:none;">
    <option value="todas">Todas Categorias</option>
  </select>

  <button onclick="gerarRelatorio()"
    style="background:#00c896;border:none;padding:6px 10px;border-radius:6px;color:white;cursor:pointer;">
    Aplicar Filtro
  </button>
  <button onclick="gerarPDF()"
  style="background:#444;border:none;padding:6px 10px;border-radius:6px;color:white;cursor:pointer;">
  Gerar PDF
</button>

</div>

  <div id="conteudoRelatorio" style="margin-top:20px;"></div>

</div>

<!-- TELA NOTIFICAÃ‡Ã•ES -->
<div id="telaNotificacoes" class="screen">

  <button onclick="fecharTela('telaNotificacoes')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2 style="margin-top:0;">ğŸ”” NotificaÃ§Ãµes</h2>

  <div id="listaNotificacoes" style="margin-top:20px;"></div>

</div>

<!-- TELA NOVA CONTA -->
<div id="telaNovaConta" class="screen">

  <button onclick="fecharTela('telaNovaConta')" 
    style="background:none;border:none;color:white;font-size:16px;margin-bottom:20px;cursor:pointer;">
    â† Voltar
  </button>

  <h2>â• Nova Conta</h2>

  <p>Nome da Conta:</p>
  <input type="text" id="nomeContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Valor:</p>
  <input type="number" id="valorContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <p style="margin-top:15px;">Data de Vencimento:</p>
  <input type="date" id="vencimentoContaInput"
    style="width:100%;padding:8px;border-radius:6px;border:none;">

  <label style="margin-top:10px;">Repetir por (meses):</label>
  <input type="number" id="repetirMeses" min="1" value="1"
       style="width:100%;padding:8px;margin-top:5px;border-radius:6px;border:none;">


  <button onclick="salvarNovaConta()"
    style="margin-top:20px;background:#00c896;border:none;padding:10px 15px;border-radius:8px;color:white;cursor:pointer;">
    Salvar Conta
  </button>

</div>
  
<script>

let progresso = 0;
let currentQuestion = 0;
let answers = [];
let userProfile = "";
let emojiSelecionado = "ğŸ¯";
let desafios = [];
const mapaEmojis = {
  "viagem": "âœˆï¸",
  "viajar": "âœˆï¸",
  "passagem": "âœˆï¸",

  "celular": "ğŸ“±",
  "iphone": "ğŸ“±",

  "computador": "ğŸ’»",
  "notebook": "ğŸ’»",

  "carro": "ğŸš—",
  "automÃ³vel": "ğŸš—",

  "presente": "ğŸ",
  "natal": "ğŸ",
  "aniversÃ¡rio": "ğŸ‚",
  "pÃ¡scoa": "ğŸ",

  "dinheiro": "ğŸ’°",
  "reserva": "ğŸ’°",

  "meta": "ğŸ¯",
  "objetivo": "ğŸ¯",

  "caixa": "ğŸ“¦"
};
let saldo = 0;
let dividaAtual = 0;
// ===== SISTEMA 10% OPCIONAL =====
let sistema10Ativo = false;
let estadoMentorAtual = "estavel";
let pendenteEntradas = 0;
let pendenteSaidas = 0;
let vozesDisponiveis = [];

speechSynthesis.onvoiceschanged = function() {
  vozesDisponiveis = speechSynthesis.getVoices();
};
// ğŸ”” SISTEMA DE NOTIFICAÃ‡Ã•ES
let notificacoes = [];
let evellynMutada = false;
let notificacoesNaoLidas = 0;
let desafioAtualIndex = null;
// ğŸ”Š CONTROLE DE VOZ
let vozAtivada = true;
let rendaMensalBase = 0;
let moedaUsuario = "â‚¬";
let categorias = [];
let historicoSaidas = [];
let contas = [];
function selecionarEmoji(emoji){

  emojiSelecionado = emoji;

  const nomesPadrao = {
    "âœˆï¸": "Viagem",
    "ğŸ“±": "Celular",
    "ğŸ’»": "Computador",
    "ğŸš—": "Carro",
    "ğŸ": "Presente",
    "ğŸ·": "Reserva",
    "ğŸ‚": "AniversÃ¡rio",
    "ğŸ’°": "Dinheiro",
    "ğŸ“¦": "Compra",
    "ğŸ¯": "Meta"
  };

  if(nomesPadrao[emoji]){
    document.getElementById("nomeDesafio").value = nomesPadrao[emoji];
  }

}
/* ===== PLANOS POR PERFIL ===== */
let metaMensal = 0;
let valorGuardado = 0;
const planosPerfil = {

  "CrÃ­tico": {
    porcentagem: 0.05,
    titulo: "Plano de ReorganizaÃ§Ã£o Financeira",
    etapas: [
      "Guardar 5% de cada entrada.",
      "Registrar todos os gastos por 30 dias.",
      "Criar disciplina antes de aumentar a meta."
    ]
  },

  "Iniciante": {
    porcentagem: 0.08,
    titulo: "Plano de ConstruÃ§Ã£o de Base",
    etapas: [
      "Guardar 8% de cada entrada.",
      "Separar despesas fixas e variÃ¡veis.",
      "Criar reserva equivalente a 1 mÃªs."
    ]
  },

  "Em EvoluÃ§Ã£o": {
    porcentagem: 0.10,
    titulo: "Plano de Crescimento",
    etapas: [
      "Guardar 10% de cada entrada.",
      "Eliminar desperdÃ­cios mensais.",
      "Fortalecer reserva progressivamente."
    ]
  },

  "IntermediÃ¡rio": {
    porcentagem: 0.15,
    titulo: "Plano de ConsolidaÃ§Ã£o",
    etapas: [
      "Guardar 15% de cada entrada.",
      "Expandir reserva para 3 meses.",
      "Criar metas de investimento."
    ]
  },

  "EstÃ¡vel": {
    porcentagem: 0.20,
    titulo: "Plano de IndependÃªncia",
    etapas: [
      "Guardar 20% de cada entrada.",
      "Criar fundo estratÃ©gico.",
      "Preparar capital para investimento."
    ]
  }

};
  
const questions = [

{
  question: "Qual seu maior objetivo financeiro?",
  multi: true,
  options: [
    "Criar reserva de emergÃªncia",
    "Fazer uma viagem",
    "Comprar um carro",
    "Quitar dÃ­vidas",
    "Ter maior estabilidade financeira"
  ]
},

{
  question: "Como estÃ¡ sua organizaÃ§Ã£o hoje?",
  multi: false,
  options: [
    "NÃ£o consigo guardar nada",
    "Guardo pouco, mas sem mÃ©todo",
    "JÃ¡ guardo, mas quero melhorar",
    "Tenho controle total"
  ]
},

{
  question: "VocÃª controla seus gastos mensalmente?",
  multi: false,
  options: [
    "NÃ£o controlo",
    "Controlo Ã s vezes",
    "Controlo quase tudo",
    "Controlo tudo detalhadamente"
  ]
},

{
  question: "VocÃª possui dÃ­vidas atualmente?",
  multi: false,
  options: [
    "Sim, muitas",
    "Algumas",
    "Poucas",
    "Nenhuma"
  ]
},

{
  question: "Quanto vocÃª consegue guardar por mÃªs?",
  multi: false,
  options: [
    "Nada",
    "AtÃ© 5%",
    "Entre 10% e 20%",
    "Mais de 20%"
  ]
}

];

function start(){
  document.getElementById("landing").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
  currentQuestion = 0;
  loadQuestion();
}

function loadQuestion(){

  const q = questions[currentQuestion];

  document.getElementById("progressText").innerText =
    "Pergunta " + (currentQuestion + 1) + " de " + questions.length;

  document.getElementById("questionText").innerText = q.question;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  q.options.forEach(option => {

    const label = document.createElement("label");
    label.className = "optionItem";

    const input = document.createElement("input");
    input.type = q.multi ? "checkbox" : "radio";
    input.name = "option";
    input.value = option;

    label.appendChild(input);
    label.appendChild(document.createTextNode(" " + option));

    optionsDiv.appendChild(label);
  });

  if(currentQuestion === questions.length - 1){
    document.getElementById("nextBtn").innerText = "Gerar Plano";
  } else {
    document.getElementById("nextBtn").innerText = "PrÃ³ximo";
  }

}

function nextQuestion(){

  const selected = document.querySelectorAll("input[name='option']:checked");

  if(selected.length === 0){
    alert("Selecione pelo menos uma opÃ§Ã£o.");
    return;
  }

  answers[currentQuestion] = [];

  selected.forEach(el => {
    answers[currentQuestion].push(el.value);
  });

  if(currentQuestion < questions.length - 1){
    currentQuestion++;
    loadQuestion();
  } else {
    showResult();
  }

}

function previousQuestion(){
  if(currentQuestion > 0){
    currentQuestion--;
    loadQuestion();
  }
}

function generateProfile() {

  const dividas = answers[3]?.[0] || "";
  const guardar = answers[4]?.[0] || "";
  console.log("Valor guardar:", guardar);
  const controle = answers[2]?.[0] || "";

  if (
    dividas === "Sim, muitas" &&
    guardar === "Nada" &&
    controle === "NÃ£o controlo"
  ) {
    userProfile = "CrÃ­tico";
  }

  else if (
    dividas === "Algumas" &&
    (guardar === "Nada" || guardar === "AtÃ© 5%")
  ) {
    userProfile = "Iniciante";
  }

  else if (
    guardar === "Entre 10% e 20%"
  ) {
    userProfile = "IntermediÃ¡rio";
  }

  else if (
    guardar === "Mais de 20%" &&
    dividas === "Nenhuma"
  ) {
    userProfile = "EstÃ¡vel";
  }

  else {
    userProfile = "Em EvoluÃ§Ã£o";
  }

}

function showResult(){

  generateProfile();
  console.log(answers);
  document.getElementById("quiz").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");

  document.getElementById("profileResult").innerHTML =
    "<strong>Seu Perfil:</strong> " + userProfile;

}
  
function goToLogin(){

  document.getElementById("result").classList.add("hidden");
  document.getElementById("login").classList.remove("hidden");

}

function goToHome(){
 const plano = planosPerfil[userProfile];

if(plano){
   metaMensal = rendaMensalBase * plano.porcentagem;
   }
  generateProfile();
  console.log("Perfil gerado:", userProfile);

  document.getElementById("setupRenda").classList.add("hidden");
  document.getElementById("login").classList.add("hidden");
  document.getElementById("result").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
  document.getElementById("perfilTipo").innerText = "Perfil: " + userProfile;
  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);
  document.getElementById("guardadoValor").innerText = valorGuardado.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);
  // ===== ATIVAR PLANO AUTOMÃTICO DO PERFIL =====


 
  let objetivo = answers[0][0];
  let desafio = "";
  let estrategia = "";
  if(objetivo === "Comprar um carro"){
    estrategia = "Criar fundo especÃ­fico para o carro e guardar 15% mensalmente.";
  }
  else if(objetivo === "Quitar dÃ­vidas"){
    estrategia = "Priorizar pagamento das dÃ­vidas antes de iniciar novos objetivos.";
  }
  else if(objetivo === "Criar reserva de emergÃªncia"){
    estrategia = "Construir reserva equivalente a 6 meses de despesas.";
  }
  

  if(userProfile === "CrÃ­tico"){
    desafio = "Anotar todos os gastos por 7 dias.";

  }

  else if(userProfile === "Iniciante"){
    desafio = "Guardar 5% da sua renda por 30 dias.";

  }

  else if(userProfile === "IntermediÃ¡rio"){
    desafio = "Criar reserva de 3 meses.";

  }

  else if(userProfile === "EstÃ¡vel"){
    desafio = "Investir para crescimento.";

  }

  else{
    desafio = "Organizar despesas fixas.";

  }
  // document.getElementById("homeDescricaoPlano").innerText = estrategia;
  // document.getElementById("homeDesafioTexto").innerText = desafio;
  atualizarDividaHeader();
  atualizarResumoContas();
  atualizarProgresso();
}

function createAccount(){

  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if(!name || !email || !password){
    alert("Preencha todos os campos.");
    return;
  }

  alert("Conta criada com sucesso!");

  document.getElementById("login").classList.add("hidden");  // ESCONDE LOGIN
  document.getElementById("setupRenda").classList.remove("hidden");

  }

function abrirDesafios(){
  document.getElementById("areaDesafios").classList.remove("hidden");

  // Rola suavemente atÃ© a Ã¡rea de desafios
  document.getElementById("areaDesafios").scrollIntoView({
    behavior: "smooth"
  });
}
  
function concluirDesafio(){

  if(progresso < 100){
    progresso += 20;
  }

  if(progresso > 100){
    progresso = 100;
  }

  document.getElementById("progressBar").style.width = progresso + "%";
  document.getElementById("progressTextBar").innerText = "Progresso: " + progresso + "%";

}

let entradasTotal = 0;
let saidasTotal = 0;
let historicoEntradas = [];


  // ğŸ”¥ Agora entra o cÃ©rebro do desafio

   function adicionarEntrada(){

  let valor = parseFloat(prompt("Digite o valor da entrada:"));

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  entradasTotal += valor;
  saldo += valor;
  // Atualiza meta baseada no perfil (apenas cÃ¡lculo, nÃ£o guarda dinheiro)

  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);


  document.getElementById("entradaValor").innerText = moedaUsuario + " " + entradasTotal.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  atualizarProgresso();
  }

function adicionarSaida(){

  if(categorias.length === 0){
    alert("Nenhuma categoria criada.");
    return;
  }

  // Escolher categoria
  let nomesCategorias = categorias
  .map((c, i) => `${i} - ${c.nome}`)
  .join("\n");

  let escolhaCategoria = prompt(
    "Escolha a categoria digitando o nÃºmero:\n\n" + nomesCategorias
  );

  if(escolhaCategoria === null) return;

  let indexCategoria = parseInt(escolhaCategoria);

  if(isNaN(indexCategoria) || !categorias[indexCategoria]){
    alert("Categoria invÃ¡lida.");
    return;
  }

  let categoria = categorias[indexCategoria];

  // Escolher subcategoria
  let nomesSub = categoria.subcategorias
  .map(function(s, i){
    return i + " - " + s.nome;
  })
  .join("\n");

  let escolhaSub = prompt(
    `Escolha a subcategoria de ${categoria.nome}:\n\n` + nomesSub
  );

  if(escolhaSub === null) return;

  let indexSub = parseInt(escolhaSub);

  if(isNaN(indexSub) || !categoria.subcategorias[indexSub]){
    alert("Subcategoria invÃ¡lida.");
    return;
  }

  let valor = parseFloat(prompt("Digite o valor da saÃ­da:"));

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  // Atualiza valores
  saldo -= valor;
  saidasTotal += valor;
  categoria.subcategorias[indexSub].total += valor;

  // Atualiza UI
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("saidaValor").innerText = moedaUsuario + " " + saidasTotal.toFixed(2);

  atualizarTelaCategorias();
}

function abrirAba(id){

  // Esconde todas as abas
  document.getElementById("home").classList.add("hidden");
  document.getElementById("desafios").classList.add("hidden");
  document.getElementById("novoDesafio").classList.add("hidden");
  document.getElementById("relatorios").classList.add("hidden");
  document.getElementById("reserva").classList.add("hidden");
  document.getElementById("emprestimo").classList.add("hidden");
  document.getElementById("configuracoes").classList.add("hidden");
  document.getElementById("contas").classList.add("hidden"); // ğŸ”¥ ESTA LINHA FALTAVA

  if(id === "reserva"){

    document.getElementById("reservaGuardadoTexto").innerText = valorGuardado.toFixed(2);
    document.getElementById("reservaMetaTexto").innerText = metaMensal.toFixed(2);
    if(sistema10Ativo){
    document.getElementById("blocoSistema10").style.display = "block";
    atualizarTelaSistema10();
    } else {
    document.getElementById("blocoSistema10").style.display = "none";
    }
    let falta = metaMensal - valorGuardado;
    if(falta < 0) falta = 0;

    document.getElementById("reservaFaltaTexto").innerText = falta.toFixed(2);
    atualizarSistema10Visual();
  }

  // Mostra a aba clicada
  document.getElementById(id).classList.remove("hidden");

  if(id === "contas"){
    atualizarListaContas();
  }

  atualizarResumoContas();
}
function guardarNaReserva(){

  let valor = parseFloat(document.getElementById("valorGuardarInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  if(valor > saldo){
    alert("VocÃª nÃ£o tem saldo suficiente.");
    return;
  }

  // Move dinheiro do saldo para reserva oficial
  saldo -= valor;
  valorGuardado += valor;

  // Atualiza UI principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  atualizarProgresso();

  // Atualiza tela da reserva
  document.getElementById("reservaGuardadoTexto").innerText = valorGuardado.toFixed(2);

  let falta = metaMensal - valorGuardado;
  if(falta < 0) falta = 0;

  document.getElementById("reservaMetaTexto").innerText = metaMensal.toFixed(2);
  document.getElementById("reservaFaltaTexto").innerText = falta.toFixed(2);

  document.getElementById("valorGuardarInput").value = "";
  atualizarProgresso();
  abrirAba("home");
}

function carregarPlanoDesafio(){

  if(!planosPerfil[userProfile]) return;

  const plano = planosPerfil[userProfile];

  // TÃ­tulo
  document.getElementById("tituloPlano").innerText = plano.titulo;

  // Etapas
  const lista = document.getElementById("etapasPlano");
  lista.innerHTML = "";

  plano.etapas.forEach(etapa => {
    const li = document.createElement("li");
    li.innerText = etapa;
    lista.appendChild(li);
  });

  // Meta baseada nas entradas
  metaMensal = rendaMensalBase * plano.porcentagem;

  document.getElementById("desafioMeta").innerText = metaMensal.toFixed(2);

  progresso = 0;

  if(metaMensal > 0){
    progresso = (valorGuardado / metaMensal) * 100;
  }

  if(progresso > 100) progresso = 100;

  document.getElementById("desafioProgresso").innerText = progresso.toFixed(0);
  document.getElementById("barraDesafio").style.width = progresso + "%";
}
  
function abrirTela(id){

  // ğŸ”¹ Limpa campos da tela de entrada
  if(id === "telaEntrada"){
    document.getElementById("nomeClienteInput").value = "";
    document.getElementById("valorEntradaInput").value = "";
  }

  // ğŸ”¹ Limpa campos da tela nova conta
  if(id === "telaNovaConta"){
    document.getElementById("nomeContaInput").value = "";
    document.getElementById("valorContaInput").value = "";
    document.getElementById("vencimentoContaInput").value = "";
  }

  // ğŸ”¹ Limpa campos da tela saÃ­da
  if(id === "telaSaida"){
    document.getElementById("valorSaidaInput").value = "";
  }

  document.getElementById(id).classList.add("active");
  if(id === "telaNotificacoes"){
  renderizarNotificacoes();
  notificacoesNaoLidas = 0;
  atualizarIconeNotificacao();
  }
}

function fecharTela(id){
  document.getElementById(id).classList.remove("active");
}

function criarDesafioPersonalizado(){

  const nome = document.getElementById("nomeDesafio").value;
  let nomeLower = nome.toLowerCase();

for (let palavra in mapaEmojis) {
  if (nomeLower.includes(palavra)) {
    emojiSelecionado = mapaEmojis[palavra];
    break;
  }
}
  const valor = parseFloat(document.getElementById("valorDesafio").value);
  const partes = parseInt(document.getElementById("partesDesafio").value);

  if(!nome || isNaN(valor) || isNaN(partes) || partes <= 0){
    alert("Preencha todos os campos corretamente.");
    return;
  }

  let novoDesafio = {
    nome: nome,
    valorTotal: valor,
    partes: partes,
    valorParcela: valor / partes,
    parcelasPagas: 0,
    emoji: emojiSelecionado
  };

  desafios.push(novoDesafio);

  // Limpa campos
  document.getElementById("nomeDesafio").value = "";
  document.getElementById("valorDesafio").value = "";
  document.getElementById("partesDesafio").value = "";

  emojiSelecionado = "ğŸ¯";

  fecharTela("telaNovoDesafio");

  atualizarListaDesafios();
}
  function atualizarListaDesafios(){

  const container = document.getElementById("listaDesafios");
  container.innerHTML = "";

  desafios.forEach((desafio, index) => {

    let porcentagem = 0;

    if(desafio.partes > 0){
      porcentagem = (desafio.parcelasPagas / desafio.partes) * 100;
    }

    const item = document.createElement("div");
    item.style.marginBottom = "15px";
    item.style.padding = "12px";
    item.style.background = "rgba(255,255,255,0.08)";
    item.style.borderRadius = "8px";

    item.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong style="font-size:16px;">
            ${desafio.emoji} ${desafio.nome}
          </strong><br>
          ${moedaUsuario} ${desafio.valorTotal.toFixed(2)}
        </div>
        <button onclick="abrirDesafio(${index})"
          style="
            background:#00c896;
            border:none;
            padding:6px 10px;
            border-radius:6px;
            color:white;
            cursor:pointer;
          ">
          Abrir â†’
        </button>
      </div>

      <div style="
        background:#333;
        height:8px;
        border-radius:5px;
        margin-top:10px;
      ">
        <div style="
          width:${porcentagem}%;
          height:8px;
          background:#00c896;
          border-radius:5px;
        "></div>
      </div>
    `;

    container.appendChild(item);

  });

}
 function abrirDesafio(index){

  desafioAtualIndex = index;
  const desafio = desafios[index];

  // Atualiza textos
  document.getElementById("tituloDetalhe").innerText =
    desafio.emoji + " " + desafio.nome;

  document.getElementById("valorTotalDetalhe").innerText =
    moedaUsuario + " " + desafio.valorTotal.toFixed(2);

  document.getElementById("valorParcelaDetalhe").innerText =
    moedaUsuario + " " + desafio.valorParcela.toFixed(2);

  // Desenha as parcelas
  atualizarParcelasVisuais();

  // Abre tela
  abrirTela("telaDetalheDesafio");
}
function atualizarParcelasVisuais(){

    const desafio = desafios[desafioAtualIndex];
    const area = document.getElementById("areaParcelas");

    area.innerHTML = "";

    for(let i = 0; i < desafio.partes; i++){

        const span = document.createElement("span");

        if(i < desafio.parcelasPagas){
            span.innerText = "ğŸŸ¢";
        } else {
            span.innerText = desafio.emoji;
        }

        area.appendChild(span);
    }

}
 function pagarParcela(){

  const desafio = desafios[desafioAtualIndex];

  if(desafio.parcelasPagas >= desafio.partes){
    alert("Todas as parcelas jÃ¡ foram pagas.");
    return;
  }

  // ğŸ”¥ Verifica se tem saldo suficiente
  if(saldo < desafio.valorParcela){
    alert("Saldo insuficiente para pagar esta parcela.");
    return;
  }

  // ğŸ’¸ Desconta do saldo
  saldo -= desafio.valorParcela;

  // ğŸ· Adiciona na reserva
  valorGuardado += desafio.valorParcela;

  // Marca parcela como paga
  desafio.parcelasPagas++;

  // ğŸ”„ Atualiza cards da Home
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza visual das parcelas
  atualizarParcelasVisuais();

  // Atualiza lista principal
  atualizarListaDesafios();

}
  function encerrarDesafio(){

  if(desafioAtualIndex === null) return;

  if(!confirm("Encerrar este desafio? As parcelas pagas continuarÃ£o na sua reserva.")){
    return;
  }

  // Remove da lista
  desafios.splice(desafioAtualIndex, 1);

  desafioAtualIndex = null;

  fecharTela("telaDetalheDesafio");
  atualizarListaDesafios();

}
  function confirmarRenda(){

  let valor = parseFloat(document.getElementById("rendaInput").value);
  moedaUsuario = document.getElementById("moedaSelect").value;
  // Atualiza saldo e reserva imediatamente
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);
  if(isNaN(valor) || valor <= 0){
    alert("Digite um valor vÃ¡lido.");
    return;
  }

  rendaMensalBase = valor;

  // ğŸ”¥ Gera perfil se ainda nÃ£o estiver gerado
  if(!userProfile){
    generateProfile();
  }

  // ğŸ”¥ Calcula meta baseada no perfil
  const plano = planosPerfil[userProfile];

  if(plano){
    metaMensal = rendaMensalBase * plano.porcentagem;
  }

  gerarCategoriasBase();

  document.getElementById("setupRenda").classList.add("hidden");

  goToHome();
}
  function atualizarTelaCategorias(){

  const container = document.getElementById("listaCategorias");
  container.innerHTML = "";

  categorias.forEach((categoria, index) => {
    let totalCategoria = categoria.subcategorias.reduce(
    (acc, sub) => acc + sub.total, 0
    );
    let porcentagem = 0;

    if(categoria.piso > 0){
      porcentagem = (totalCategoria / categoria.piso) * 100;
    }

    let corBarra = "#00c896"; // verde padrÃ£o

    if(porcentagem >= 80 && porcentagem < 100){
      corBarra = "#f4b400"; // amarelo
  }
    else if(porcentagem >= 100){
      corBarra = "#ff4d4d"; // vermelho
  }

    const card = document.createElement("div");
    card.style.marginBottom = "20px";
    card.style.padding = "15px";
    card.style.background = "rgba(255,255,255,0.08)";
    card.style.borderRadius = "10px";

    card.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <strong>${categoria.nome}</strong>
  <span>
    ${moedaUsuario} ${totalCategoria.toFixed(2)} /
    <span
     style="
       cursor:pointer;
       text-decoration:underline;
       font-weight:600;
    "
    title="Clique para editar o limite"
    onclick="editarPiso(${index})">
    ${moedaUsuario} ${categoria.piso.toFixed(2)} âœï¸
  </span>
</span>
      </div>

      <div style="
        background:#333;
        height:10px;
        border-radius:6px;
        margin-top:10px;
        overflow:hidden;
      ">
        <div style="
          width:${porcentagem}%;
          height:10px;
          background:${corBarra};
          transition:0.4s;
        "></div>
      </div>
    `;

    container.appendChild(card);

  });

}
  function gerarCategoriasBase(){

  categorias = []; // limpa se jÃ¡ existir algo

  if(!rendaMensalBase || !userProfile) return;

  let distribuicao = {};

  if(userProfile === "CrÃ­tico"){
    distribuicao = {
      "Essencial": 0.60,
      "Fixos": 0.25,
      "Lazer": 0.05,
      "EsporÃ¡dicos": 0.05
    };
  }

  else if(userProfile === "Iniciante"){
    distribuicao = {
      "Essencial": 0.50,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "EsporÃ¡dicos": 0.07
    };
  }

  else if(userProfile === "IntermediÃ¡rio"){
    distribuicao = {
      "Essencial": 0.40,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "EsporÃ¡dicos": 0.10
    };
  }

  else if(userProfile === "EstÃ¡vel"){
    distribuicao = {
      "Essencial": 0.35,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "EsporÃ¡dicos": 0.10
    };
  }

  else { // Em EvoluÃ§Ã£o
    distribuicao = {
      "Essencial": 0.45,
      "Fixos": 0.25,
      "Lazer": 0.10,
      "EsporÃ¡dicos": 0.10
    };
  }

  for (let nome in distribuicao){

  let pisoCalculado = rendaMensalBase * distribuicao[nome];

  let subcategoriasPadrao = [];

  if(nome === "Essencial"){
    subcategoriasPadrao = [
      { nome: "Mercado", total: 0 },
      { nome: "FarmÃ¡cia", total: 0 }
    ];
  }

  else if(nome === "Fixos"){
    subcategoriasPadrao = [
      { nome: "Aluguel", total: 0 },
      { nome: "Luz", total: 0 },
      { nome: "Ãgua", total: 0 },
      { nome: "Internet", total: 0 }
    ];
  }

  else if(nome === "Lazer"){
    subcategoriasPadrao = [
      { nome: "Restaurante", total: 0 },
      { nome: "Cinema", total: 0 }
    ];
  }

  else if(nome === "EsporÃ¡dicos"){
    subcategoriasPadrao = [
      { nome: "Roupas", total: 0 },
      { nome: "ManutenÃ§Ã£o", total: 0 }
    ];
  }

  else{
    subcategoriasPadrao = [];
  }

  categorias.push({
    nome: nome,
    piso: pisoCalculado,
    subcategorias: subcategoriasPadrao
  });

}
}
 function abrirTelaSaida(){

  if(categorias.length === 0){
    alert("Nenhuma categoria criada.");
    return;
  }

  abrirTela("telaSaida");

  const selectCategoria = document.getElementById("selectCategoria");
  const selectSub = document.getElementById("selectSubcategoria");

  selectCategoria.innerHTML = "";
  selectSub.innerHTML = "";

  categorias.forEach(function(cat, index){
    let option = document.createElement("option");
    option.value = index;
    option.text = cat.nome;
    selectCategoria.appendChild(option);
  });

  atualizarSubcategorias();
}

function atualizarSubcategorias(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const selectSub = document.getElementById("selectSubcategoria");

  selectSub.innerHTML = "";

  categorias[indexCategoria].subcategorias.forEach(function(sub, i){
    let option = document.createElement("option");
    option.value = i;
    option.text = sub.nome;
    selectSub.appendChild(option);
  });
}

document.addEventListener("change", function(e){
  if(e.target.id === "selectCategoria"){
    atualizarSubcategorias();
  }
});

function confirmarSaida(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const indexSub = document.getElementById("selectSubcategoria").value;
  const valor = parseFloat(document.getElementById("valorSaidaInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  saldo -= valor;
  saidasTotal += valor;
  // ğŸ”¥ SISTEMA 10%
if(sistema10Ativo){
  pendenteSaidas += valor * 0.10;
}

  categorias[indexCategoria].subcategorias[indexSub].total += valor;
  // ğŸ”¥ Verificar limite da categoria
  // ğŸ”¥ Registrar no histÃ³rico
let agora = new Date();

historicoSaidas.push({
  data: agora.toLocaleDateString(),
  hora: agora.toLocaleTimeString(),
  categoria: categorias[indexCategoria].nome,
  subcategoria: categorias[indexCategoria].subcategorias[indexSub].nome,
  valor: valor
});

let categoria = categorias[indexCategoria];

let totalCategoria = categoria.subcategorias.reduce(function(acc, sub){
  return acc + sub.total;
}, 0);

let porcentagem = (totalCategoria / categoria.piso) * 100;

if(porcentagem >= 120){
  let excesso = totalCategoria - categoria.piso;
  alert("ğŸš¨ VocÃª ultrapassou o limite da categoria " 
        + categoria.nome + 
        " em " + moedaUsuario + " " + excesso.toFixed(2));
}

else if(porcentagem >= 100){
  alert("ğŸš¨ VocÃª atingiu o limite da categoria " 
        + categoria.nome);
}

else if(porcentagem >= 80){
  alert("âš ï¸ AtenÃ§Ã£o: vocÃª estÃ¡ prÃ³ximo do limite da categoria " 
        + categoria.nome);
}

  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("saidaValor").innerText = moedaUsuario + " " + saidasTotal.toFixed(2);
  analisarSituacaoFinanceira();
  fecharTela("telaSaida");
  atualizarTelaCategorias();
}

 function adicionarSubcategoria(){

  const indexCategoria = document.getElementById("selectCategoria").value;

  let nome = prompt("Digite o nome da nova subcategoria:");

  if(!nome || nome.trim() === ""){
    alert("Nome invÃ¡lido.");
    return;
  }

  categorias[indexCategoria].subcategorias.push({
    nome: nome,
    total: 0
  });

  atualizarSubcategorias();
}

  function excluirSubcategoria(){

  const indexCategoria = document.getElementById("selectCategoria").value;
  const indexSub = document.getElementById("selectSubcategoria").value;

  let sub = categorias[indexCategoria].subcategorias[indexSub];

  if(!sub){
    alert("Nenhuma subcategoria selecionada.");
    return;
  }

  if(sub.total > 0){

    let confirmar = confirm(
      "Esta subcategoria possui " + moedaUsuario + " " + sub.total.toFixed(2)+ 
      " registrados.\n\nOs valores continuarÃ£o contabilizados no saldo e relatÃ³rios.\n\nDeseja excluir mesmo assim?"
    );

    if(!confirmar) return;
  }

  categorias[indexCategoria].subcategorias.splice(indexSub, 1);

  atualizarSubcategorias();
}

  function confirmarEntrada(){
  console.log("confirmarEntrada foi chamada");
  const nome = document.getElementById("nomeClienteInput").value;
  const valor = parseFloat(document.getElementById("valorEntradaInput").value);

  if(!nome || isNaN(valor) || valor <= 0){
    alert("Preencha nome e valor corretamente.");
    return;
  }

  // Soma valores
  entradasTotal += valor;
  saldo += valor;
  // ğŸ”¥ SISTEMA 10%
if(sistema10Ativo){
  pendenteEntradas += valor * 0.10;
}
  // ğŸ”¥ Criar registro com data e mÃªs
let agora = new Date();

let registroEntrada = {
  cliente: nome,
  valor: valor,
  data: agora.toLocaleDateString("pt-PT"),
  hora: agora.toLocaleTimeString("pt-PT"),
  mes: agora.getMonth() + 1,
  ano: agora.getFullYear()
};

historicoEntradas.push(registroEntrada);
  // ğŸ”¥ Atualiza meta baseada no perfil
  // Atualiza UI principal
  document.getElementById("entradaValor").innerText = moedaUsuario + " " + entradasTotal.toFixed(2);
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  if(!userProfile){
  generateProfile();
}
  // Atualiza barra da meta
  atualizarProgresso();

  // ğŸ”¥ Se tela de desafios estiver aberta, atualiza tambÃ©m
  carregarPlanoDesafio();

  // Limpa campos
  document.getElementById("nomeClienteInput").value = "";
  document.getElementById("valorEntradaInput").value = "";
  analisarSituacaoFinanceira(true);
  verificarEvolucaoPerfil();
  fecharTela("telaEntrada");
  abrirAba("home");
  
}

 function gerarRelatorio(){

  let html = "";
  let mesSelecionado = document.getElementById("filtroMes").value;
  let categoriaSelecionada = document.getElementById("filtroCategoria").value;

  // ğŸ”¥ BLOCO DÃVIDA
  if(dividaAtual > 0){
    html += "<h3>DÃ­vida Atual</h3>";
    html += "ğŸ’³ " + moedaUsuario + " " + dividaAtual.toFixed(2) + "<br><br>";
  }

  // ğŸ”¥ BLOCO PERFIL + META

  let porcentagemMeta = 0;

  if(metaMensal > 0){
    porcentagemMeta = (valorGuardado / metaMensal) * 100;
  }

  if(porcentagemMeta > 100){
    porcentagemMeta = 100;
  }

  html += "<h3>Perfil Financeiro</h3>";
  html += "Perfil: " + userProfile + "<br>";
  html += "Meta do Perfil: " + moedaUsuario + " " + metaMensal.toFixed(2) + "<br>";
  html += "Guardado: " + moedaUsuario + " " + valorGuardado.toFixed(2) +
          " (" + porcentagemMeta.toFixed(0) + "%)<br><br>";

  html += "<h3>Resumo Geral</h3>";

  let totalSaidasFiltradas = 0;

  if(categoriaSelecionada === "todas"){
    totalSaidasFiltradas = saidasTotal;
  } else {

    totalSaidasFiltradas = historicoSaidas
      .filter(function(item){
        return item.categoria === categoriaSelecionada;
      })
      .reduce(function(acc, item){
        return acc + item.valor;
      }, 0);
  }

  html += "Saldo: " + moedaUsuario + " " + saldo.toFixed(2) + "<br>";
  html += "Entradas: " + moedaUsuario + " " + entradasTotal.toFixed(2) + "<br>";
  html += "SaÃ­das: " + moedaUsuario + " " + totalSaidasFiltradas.toFixed(2) + "<br>";
  html += "Reserva: " + moedaUsuario + " " + valorGuardado.toFixed(2) + "<br><br>";

  html += "<h3>HistÃ³rico de Entradas</h3>";

  let entradasFiltradas = historicoEntradas.filter(function(item){
    let passaMes = (mesSelecionado === "todos" || item.mes == mesSelecionado);
    return passaMes;
  });

  if(entradasFiltradas.length === 0){
    html += "Nenhuma entrada encontrada.<br>";
  } else {

    entradasFiltradas.forEach(function(item){

      html += item.data + " " + item.hora + " â€” " +
              "Cliente: " + item.cliente +
              " â€” " + moedaUsuario + " " + item.valor.toFixed(2) + "<br>";

    });

  }

  html += "<br>";
  html += "<h3>Categorias</h3>";

  let categoriasFiltradas = categorias.filter(function(cat){

    if(categoriaSelecionada === "todas"){
      return true;
    }

    return cat.nome === categoriaSelecionada;
  });

  categoriasFiltradas.forEach(function(cat){

    let total = cat.subcategorias.reduce(function(acc, sub){
      return acc + sub.total;
    }, 0);

    html += cat.nome + ": " + moedaUsuario + " " + total.toFixed(2) + "<br>";

  });

  html += "<br><h3>HistÃ³rico de SaÃ­das</h3>";

  if(historicoSaidas.length === 0){
    html += "Nenhuma saÃ­da registrada.<br>";
  } else {

    historicoSaidas.forEach(item => {

      html += `
        ${item.data} ${item.hora} â€”
        ${item.categoria} > ${item.subcategoria}
        â€” ${moedaUsuario} ${item.valor.toFixed(2)}<br>
      `;

    });

  }

  html += "<br><h3>Desafios</h3>";

  desafios.forEach(desafio => {

    let porcentagem = 0;

    if(desafio.partes > 0){
      porcentagem = (desafio.parcelasPagas / desafio.partes) * 100;
    }

    html += desafio.emoji + " " + desafio.nome +
      " â€” " + porcentagem.toFixed(0) + "% concluÃ­do<br>";
  });

  document.getElementById("conteudoRelatorio").innerHTML = html;
}
  function preencherFiltrosRelatorio(){

  const selectMes = document.getElementById("filtroMes");
  const selectCategoria = document.getElementById("filtroCategoria");

  selectMes.innerHTML = '<option value="todos">Todos os Meses</option>';
  selectCategoria.innerHTML = '<option value="todas">Todas Categorias</option>';

  // Meses
  let meses = new Set();

  historicoEntradas.forEach(e => meses.add(e.mes));
  historicoSaidas.forEach(s => {
    let partes = s.data.split("/");
    meses.add(parseInt(partes[1]));
  });

  meses.forEach(m => {
    let option = document.createElement("option");
    option.value = m;
    option.text = "MÃªs " + m;
    selectMes.appendChild(option);
  });

  // Categorias
  categorias.forEach(cat => {
    let option = document.createElement("option");
    option.value = cat.nome;
    option.text = cat.nome;
    selectCategoria.appendChild(option);
  });

}

 function editarPiso(index){

  let novoValor = prompt("Digite o novo limite para esta categoria:");

  if(novoValor === null) return;

  novoValor = parseFloat(novoValor);

  if(isNaN(novoValor) || novoValor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  categorias[index].piso = novoValor;

  atualizarTelaCategorias();
}
  function gerarPDF(){
  window.print();
}
  function pegarEmprestimo(){

  let valor = parseFloat(document.getElementById("valorEmprestimoInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  if(valor > valorGuardado){
    alert("VocÃª nÃ£o tem reserva suficiente.");
    return;
  }

  // Sai da reserva
  valorGuardado -= valor;

  // Entra no saldo
  saldo += valor;

  // Aumenta dÃ­vida
  dividaAtual += valor;

  // Atualiza interface principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza texto da dÃ­vida
  document.getElementById("dividaAtualTexto").innerText = dividaAtual.toFixed(2);
  atualizarDividaHeader();
  // Limpa campo
  document.getElementById("valorEmprestimoInput").value = "";
  analisarSituacaoFinanceira();

}
  function pagarEmprestimo(){
  alert("FunÃ§Ã£o pagar chamada");
  let valor = parseFloat(document.getElementById("valorPagamentoInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Valor invÃ¡lido.");
    return;
  }

  if(valor > saldo){
    alert("VocÃª nÃ£o tem saldo suficiente.");
    return;
  }

  if(valor > dividaAtual){
    alert("O valor Ã© maior que a dÃ­vida atual.");
    return;
  }

  // Sai do saldo
  saldo -= valor;

  // Volta para reserva
  valorGuardado += valor;

  // Reduz dÃ­vida
  dividaAtual -= valor;

  // Atualiza interface principal
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  // Atualiza texto da dÃ­vida
  document.getElementById("dividaAtualTexto").innerText = dividaAtual.toFixed(2);
  atualizarDividaHeader();
  // Limpa campo
  document.getElementById("valorPagamentoInput").value = "";
  analisarSituacaoFinanceira();

}
  function sacarDaReserva(){

  let valor = parseFloat(document.getElementById("valorSaqueReservaInput").value);
  let motivo = document.getElementById("motivoSaqueSelect").value;

  if(isNaN(valor) || valor <= 0){
    alert("Digite um valor vÃ¡lido.");
    return;
  }

  if(valor > valorGuardado){
    alert("VocÃª nÃ£o tem esse valor disponÃ­vel na reserva.");
    return;
  }

  let reservaAntes = valorGuardado;
  let reservaDepois = reservaAntes - valor;

  // ğŸ” Piso 30%
  let pisoMinimo = reservaAntes * 0.30;

  // âš ï¸ VerificaÃ§Ã£o de proteÃ§Ã£o
  if(reservaDepois < pisoMinimo){

    let confirmar = confirm(
      "AtenÃ§Ã£o.\n\n" +
      "Se confirmar, sua reserva ficarÃ¡ em " +
      moedaUsuario + " " + reservaDepois.toFixed(2) + ".\n\n" +
      "O mÃ­nimo recomendado para sua proteÃ§Ã£o Ã© " +
      moedaUsuario + " " + pisoMinimo.toFixed(2) + ".\n\n" +
      "Deseja continuar mesmo assim?"
    );

    if(!confirmar){
      return;
    }
  }

  // ğŸ’¸ Executa saque
  valorGuardado -= valor;

  // ğŸ”„ Atualiza interface
  document.getElementById("reservaValor").innerText =
    moedaUsuario + " " + valorGuardado.toFixed(2);

  // ğŸ“ Registrar no histÃ³rico como movimentaÃ§Ã£o patrimonial
  let agora = new Date();

  historicoSaidas.push({
    data: agora.toLocaleDateString("pt-PT"),
    hora: agora.toLocaleTimeString("pt-PT"),
    categoria: "Reserva",
    subcategoria: "Saque - " + motivo,
    valor: valor
  });

  // ğŸ”” Mensagem da Evelyn
  mostrarMensagemMentor(
    "VocÃª retirou " + moedaUsuario + " " + valor.toFixed(2) +
    " da sua reserva. Sua proteÃ§Ã£o atual Ã© " +
    moedaUsuario + " " + valorGuardado.toFixed(2) + "."
  );

  document.getElementById("valorSaqueReservaInput").value = "";

}
  function atualizarDividaHeader(){

  console.log("Atualizando header. DÃ­vida atual:", dividaAtual);

  if(dividaAtual > 0){

    document.getElementById("dividaHeader").style.display = "block";
    document.getElementById("dividaHeader").innerText =
       "ğŸ’³ DÃ­vida: " + moedaUsuario + " " + dividaAtual.toFixed(2);

  } else {

    document.getElementById("dividaHeader").style.display = "none";

  }

}
  function atualizarListaContas(){

  const container = document.getElementById("listaContas");
  container.innerHTML = "";

  if(contas.length === 0){
    container.innerHTML = "Nenhuma conta cadastrada.";
    return;
  }

  contas.forEach((conta, index) => {

    const div = document.createElement("div");

    div.style.background = "rgba(255,255,255,0.08)";
    div.style.padding = "15px";
    div.style.borderRadius = "10px";
    div.style.marginBottom = "15px";

    
  const hoje = new Date();
const vencimento = new Date(conta.vencimento);

const diffTime = vencimento - hoje;
const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

let statusTexto = "";
let corStatus = "#00c896";

if(diffDias < 0){
  statusTexto = "ğŸ”´ Conta vencida";
  corStatus = "#ff4d4d";
}
else if(diffDias <= 3){
  statusTexto = "ğŸŸ¡ Vence em " + diffDias + " dias";
  corStatus = "#f4b400";
}
else{
  statusTexto = "ğŸŸ¢ Dentro do prazo";
}

div.innerHTML =
 "<strong>" + conta.nome +
(conta.totalParcelas > 1 ? " (" + conta.parcelaAtual + "/" + conta.totalParcelas + ")" : "") +
"</strong><br>" +
  "Valor: " + moedaUsuario + " " + conta.valor.toFixed(2) + "<br>" +
  "Vencimento: " + conta.vencimento + "<br>" +
  "<span style='color:" + corStatus + "; font-weight:600;'>" +
  statusTexto +
  "</span>" +
  "<br><br>" +
  "<button onclick='pagarConta(" + index + ")' " +
"style='background:#00c896;border:none;padding:6px 10px;border-radius:6px;color:white;'>" +
"âœ“ Marcar como Paga</button>" +
"<br><br>" +
"<button onclick='excluirConta(" + index + ")' " +
"style='background:#ff4d4f;border:none;padding:6px 10px;border-radius:6px;color:white;'>" +
"ğŸ—‘ Excluir</button>";
  container.appendChild(div);

  });

}

  function atualizarResumoContas(){

  const header = document.getElementById("contasResumo");

  if(!header) return;

  if(contas.length === 0){
    header.innerHTML = "ğŸ§¾ Contas: ğŸŸ¢ Nenhuma pendente";
    return;
  }

  let vencidas = 0;
  let vencendo = 0;

  const hoje = new Date();

  contas.forEach(conta => {

    if(conta.paga) return;

    const vencimento = new Date(conta.vencimento);
    const diffTime = vencimento - hoje;
    const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if(diffDias < 0){
      vencidas++;
    }
    else if(diffDias <= 3){
      vencendo++;
    }

  });

  if(vencidas > 0){
    header.innerHTML = "ğŸ§¾ Contas: ğŸ”´ " + vencidas + " vencida(s)";
  }
  else if(vencendo > 0){
    header.innerHTML = "ğŸ§¾ Contas: ğŸŸ¡ " + vencendo + " vencendo";
  }
  else{
    header.innerHTML = "ğŸ§¾ Contas: ğŸŸ¢ Nenhuma pendente";
  }

}
  function salvarConta(){

  const nome = document.getElementById("novaContaNome").value;
  const valor = parseFloat(document.getElementById("novaContaValor").value);
  const vencimento = document.getElementById("novaContaVencimento").value;
 

  if(!nome || isNaN(valor) || !vencimento){
    alert("Preencha todos os campos.");
    return;
  }

  const repetirMeses = parseInt(document.getElementById("repetirMeses").value) || 1;

for(let i = 0; i < repetirMeses; i++){

  const dataOriginal = new Date(vencimento);
  dataOriginal.setMonth(dataOriginal.getMonth() + i);

  contas.push({
    nome: nome,
    valor: valor,
    vencimento: novaData,
    paga: false,
    parcelaAtual: i + 1,
    totalParcelas: repetirMeses
  });

}
  document.getElementById("repetirMeses").value = 1;
  document.getElementById("novaContaNome").value = "";
  document.getElementById("novaContaValor").value = "";
  document.getElementById("novaContaVencimento").value = "";

  fecharTela("telaNovaConta");
  atualizarListaContas();
  atualizarResumoContas();
}
function salvarNovaConta(){

  console.log("Repetir meses:", document.getElementById("repetirMeses").value);

  const nome = document.getElementById("nomeContaInput").value;
  const valor = parseFloat(document.getElementById("valorContaInput").value);
  const vencimento = document.getElementById("vencimentoContaInput").value;
  const repetirMeses = parseInt(document.getElementById("repetirMeses").value) || 1;

  if(!nome || isNaN(valor) || !vencimento){
    alert("Preencha todos os campos corretamente.");
    return;
  }

  for(let i = 0; i < repetirMeses; i++){

    const dataBase = new Date(vencimento);
    dataBase.setMonth(dataBase.getMonth() + i);

   contas.push({
    nome: nome,
    valor: valor,
    vencimento: dataBase.toISOString().split("T")[0],
    paga: false,
    alertas: {
    d3: false,
    d2: false,
    d1: false,
    hoje: false,
    vencida: false
  }
  });

  }

  alert("Conta(s) adicionada(s) com sucesso!");

  atualizarListaContas();
  atualizarResumoContas();

  fecharTela("telaNovaConta");

}
 function pagarConta(index){
console.log("clicou pagarConta");

  const conta = contas[index];

  if(conta.valor > saldo){
    alert("Saldo insuficiente para pagar esta conta.");
    return;
  }

  // ğŸ’¸ Baixa do saldo
  saldo -= conta.valor;
  saidasTotal += conta.valor;

  document.getElementById("saldoValor").innerText =
    moedaUsuario + " " + saldo.toFixed(2);

  document.getElementById("saidaValor").innerText =
    moedaUsuario + " " + saidasTotal.toFixed(2);

  // ğŸ“Š Registra no histÃ³rico
  let agora = new Date();

  historicoSaidas.push({
    data: agora.toLocaleDateString("pt-PT"),
    hora: agora.toLocaleTimeString("pt-PT"),
    categoria: "Contas",
    subcategoria: conta.nome,
    valor: conta.valor
  });

  // ğŸ” Se for conta recorrente, cria prÃ³xima automaticamente
  if(conta.recorrente){

    const novaData = new Date(conta.vencimento);
    novaData.setMonth(novaData.getMonth() + 1);

    contas.push({
      nome: conta.nome,
      valor: conta.valor,
      vencimento: novaData.toISOString().split("T")[0],
      paga: false,
      recorrente: true
    });

  }

  // ğŸ—‘ Remove a conta atual (paga)
  contas.splice(index, 1);

  atualizarListaContas();
  atualizarResumoContas();
}
  function excluirConta(index){
  console.log("Excluir index:", index);

  if(confirm("Tem certeza que deseja excluir esta conta?")){
    contas.splice(index, 1);
    atualizarListaContas();
    atualizarResumoContas();
  }
}
  function atualizarProgresso(){

  // Atualiza texto ÑÑ‡Ğ¸Ñ‚Ğ° na Home
  document.getElementById("guardadoValor").innerText = valorGuardado.toFixed(2);
  document.getElementById("metaValor").innerText = metaMensal.toFixed(2);
  document.getElementById("moedaMeta").innerText = moedaUsuario + " ";
  document.getElementById("moedaGuardado").innerText = moedaUsuario + " ";
  let porcentagem = 0;

  if(metaMensal > 0){
    porcentagem = (valorGuardado / metaMensal) * 100;
    if(porcentagem > 100){
      porcentagem = 100;
    }
  }

  document.getElementById("barraMeta").style.width = porcentagem + "%";
}
  function aplicarAjusteSaldo(){

  let valor = parseFloat(document.getElementById("ajusteSaldoInput").value);

  if(isNaN(valor) || valor === 0){
    alert("Digite um valor vÃ¡lido.");
    return;
  }

  // Verifica se vai deixar saldo negativo
  if(saldo + valor < 0){
    alert("O ajuste deixaria o saldo negativo.");
    return;
  }

  // Aplica ajuste
  saldo += valor;

  // Atualiza card da Home
  document.getElementById("saldoValor").innerText =
    moedaUsuario + " " + saldo.toFixed(2);

  // Limpa campo
  document.getElementById("ajusteSaldoInput").value = "";

  alert("Saldo ajustado com sucesso!");

}
  function toggleSistema10(){

  const check = document.getElementById("toggleSistema10");

  sistema10Ativo = check.checked;

  if(sistema10Ativo){
    alert("Sistema 10% ativado.");
  } else {
    alert("Sistema 10% desativado.");
  }

}

  function atualizarSistema10Visual(){

  const bloco = document.getElementById("blocoSistema10");

  if(!bloco) return;

  if(sistema10Ativo){

    bloco.style.display = "block";

    document.getElementById("pendenteEntradasTexto").innerText =
      moedaUsuario + " " + pendenteEntradas.toFixed(2);

    document.getElementById("pendenteSaidasTexto").innerText =
      moedaUsuario + " " + pendenteSaidas.toFixed(2);

    let total = pendenteEntradas + pendenteSaidas;

    document.getElementById("pendenteTotalTexto").innerText =
      moedaUsuario + " " + total.toFixed(2);

  } else {

    bloco.style.display = "none";

  }

}
  function separarManual10(){

  let valor = parseFloat(document.getElementById("valorSepararManualInput").value);

  if(isNaN(valor) || valor <= 0){
    alert("Digite um valor vÃ¡lido.");
    return;
  }

  let totalPendente = pendenteEntradas + pendenteSaidas;

  if(valor > totalPendente){
    alert("VocÃª estÃ¡ tentando separar mais do que o acumulado.");
    return;
  }

  if(valor > saldo){
    alert("Saldo insuficiente.");
    return;
  }

  // ğŸ”¥ Move dinheiro do saldo para reserva
  saldo -= valor;
  valorGuardado += valor;

  // ğŸ”¥ Desconta proporcionalmente dos pendentes
  if(valor <= pendenteEntradas){
    pendenteEntradas -= valor;
  } else {
    let restante = valor - pendenteEntradas;
    pendenteEntradas = 0;
    pendenteSaidas -= restante;
  }

  if(pendenteSaidas < 0){
    pendenteSaidas = 0;
  }

  // ğŸ”¥ Atualiza interface
  document.getElementById("saldoValor").innerText = moedaUsuario + " " + saldo.toFixed(2);
  document.getElementById("reservaValor").innerText = moedaUsuario + " " + valorGuardado.toFixed(2);

  atualizarSistema10Visual();
  document.getElementById("valorSepararManualInput").value = "";
}
  function atualizarTelaSistema10(){

  document.getElementById("pendenteEntradasTexto").innerText =
    moedaUsuario + " " + pendenteEntradas.toFixed(2);

  document.getElementById("pendenteSaidasTexto").innerText =
    moedaUsuario + " " + pendenteSaidas.toFixed(2);

  document.getElementById("pendenteTotalTexto").innerText =
    moedaUsuario + " " + (pendenteEntradas + pendenteSaidas).toFixed(2);

}
  function adicionarNotificacao(tipo, mensagem){

  const agora = new Date();

  notificacoes.unshift({
    tipo: tipo,
    mensagem: mensagem,
    data: agora.toLocaleDateString("pt-PT"),
    hora: agora.toLocaleTimeString("pt-PT"),
    lida: false
  });

  notificacoesNaoLidas++;

  mostrarNotificacaoTemporaria(tipo, mensagem);
  falar(mensagem);
  atualizarIconeNotificacao();
}
  function mostrarNotificacaoTemporaria(tipo, mensagem){

  let cor = "#00c896"; // sucesso padrÃ£o

  if(tipo === "alerta") cor = "#f4b400";
  if(tipo === "erro") cor = "#ff4d4d";
  if(tipo === "info") cor = "#3b82f6";

  const div = document.createElement("div");

  div.style.position = "absolute";
  div.style.top = "30px";
  div.style.left = "50%";
  div.style.transform = "translateX(-50%)";
  div.style.width = "90%";
  div.style.background = cor;
  div.style.padding = "15px 20px";
  div.style.borderRadius = "10px";
  div.style.boxShadow = "0 4px 20px rgba(0,0,0,0.3)";
  div.style.zIndex = "999";
  div.style.color = "white";
  div.style.fontSize = "14px";
  div.style.maxWidth = "80%";
  div.style.textAlign = "center";
  div.innerText = mensagem;

  const app = document.querySelector(".app");
  app.appendChild(div);
  autoRemoverNotificacao(div, 4000);
}
  function atualizarIconeNotificacao(){

  const badge = document.getElementById("badgeNotificacao");

  if(!badge) return;

  if(notificacoesNaoLidas > 0){
    badge.style.display = "inline-block";
    badge.innerText = notificacoesNaoLidas;
  } else {
    badge.style.display = "none";
  }
}
function falar(texto){

  // ğŸ”‡ Se estiver mutado, nÃ£o fala
  if(document.getElementById("mutarEvellyn")?.checked){
    speechSynthesis.cancel();
    return;
  }

  if(!('speechSynthesis' in window)) return;

  const mensagem = new SpeechSynthesisUtterance(texto);

  // ğŸ” Procura voz pt-BR jÃ¡ carregada
  const vozBR = vozesDisponiveis.find(v => v.lang === "pt-BR");

  // Se nÃ£o encontrar, nÃ£o deixa cair para pt-PT
  if(!vozBR){
    console.log("Voz pt-BR ainda nÃ£o carregada");
    return;
  }

  mensagem.voice = vozBR;
  mensagem.lang = "pt-BR";
  mensagem.rate = 0.95;
  mensagem.pitch = 1.05;
  mensagem.volume = 1;

  speechSynthesis.cancel();
  speechSynthesis.speak(mensagem);
}
  function calcularEstadoMentor(){

  if(entradasTotal === 0){
    return "neutro";
  }

  let consumoPercent = (saidasTotal / entradasTotal) * 100;
  let reservaPercent = metaMensal > 0 ? (valorGuardado / metaMensal) * 100 : 0;
  let dividaPercent = rendaMensalBase > 0 ? (dividaAtual / rendaMensalBase) * 100 : 0;

  // ğŸ”´ RISCO
  if(
    consumoPercent >= 95 ||
    saldo <= rendaMensalBase * 0.1 ||
    dividaPercent > 60
  ){
    return "risco";
  }

  // ğŸŸ£ INÃCIO
  if(
    entradasTotal > 0 &&
    saidasTotal === 0 &&
    valorGuardado === 0 &&
    dividaAtual === 0
  ){
    return "inicio";
  }

  // ğŸŸ¢ CRESCIMENTO
  if(
    reservaPercent >= 100 &&
    consumoPercent < 70 &&
    dividaAtual === 0
  ){
    return "crescimento";
  }

  // ğŸ”µ CONSOLIDANDO
  if(
    reservaPercent >= 60 &&
    consumoPercent < 80 &&
    dividaAtual === 0
  ){
    return "consolidando";
  }

  // âšª NEUTRO
  if(
    saldo > 0 &&
    dividaAtual === 0 &&
    consumoPercent < 80
  ){
    return "neutro";
  }

  // ğŸŸ¡ ATENÃ‡ÃƒO
  return "atencao";
}
const blocosMentor = {

  inicio: {
    observacao: [
      "Que bom que entrou dinheiro ğŸ’›",
      "Entrada confirmada.",
      "Dinheiro na conta Ã© sempre um bom comeÃ§o."
    ],
    interpretacao: [
      "Agora Ã© o momento ideal para organizar.",
      "VocÃª estÃ¡ no controle agora.",
      "Esse Ã© o ponto de partida."
    ],
    orientacao: [
      "Que tal separar um pouquinho para vocÃª?",
      "Antes de gastar, pensa na sua reserva.",
      "Uma pequena decisÃ£o agora faz diferenÃ§a depois."
    ]
  },

  neutro: {
    observacao: [
      "VocÃª estÃ¡ se mantendo estÃ¡vel.",
      "Seu fluxo estÃ¡ sob controle.",
      "Nada crÃ­tico acontecendo."
    ],
    interpretacao: [
      "Isso mostra equilÃ­brio.",
      "VocÃª estÃ¡ administrando bem.",
      "EstÃ¡ tudo caminhando normalmente."
    ],
    orientacao: [
      "Se comeÃ§ar a guardar, vocÃª evolui rÃ¡pido.",
      "Talvez seja hora de fortalecer sua reserva.",
      "Pequenos ajustes podem melhorar ainda mais."
    ]
  },

  atencao: {
    observacao: [
      "Seus gastos estÃ£o comeÃ§ando a pesar.",
      "Sua margem estÃ¡ diminuindo.",
      "O ritmo pode apertar mais adiante."
    ],
    interpretacao: [
      "Isso pode comprometer sua seguranÃ§a.",
      "Vale revisar alguns pontos.",
      "Talvez esteja gastando mais do que deveria."
    ],
    orientacao: [
      "Reduz um pouco essa semana.",
      "Reveja despesas variÃ¡veis.",
      "Organiza antes que vire problema."
    ]
  },

  risco: {
    observacao: [
      "Sua estrutura ficou frÃ¡gil.",
      "O dinheiro estÃ¡ saindo rÃ¡pido demais.",
      "Sua margem de seguranÃ§a estÃ¡ muito baixa."
    ],
    interpretacao: [
      "Isso nÃ£o Ã© sustentÃ¡vel.",
      "VocÃª precisa ajustar agora.",
      "A situaÃ§Ã£o exige atenÃ§Ã£o imediata."
    ],
    orientacao: [
      "Pause gastos desnecessÃ¡rios.",
      "Reorganize suas prioridades.",
      "Foque em estabilizar primeiro."
    ]
  },

  consolidando: {
    observacao: [
      "Sua reserva jÃ¡ estÃ¡ tomando forma.",
      "VocÃª estÃ¡ fortalecendo sua base.",
      "Seu comportamento estÃ¡ mais consciente."
    ],
    interpretacao: [
      "Isso mostra disciplina.",
      "VocÃª estÃ¡ construindo seguranÃ§a real.",
      "Seu padrÃ£o estÃ¡ melhorando."
    ],
    orientacao: [
      "Continue assim.",
      "Mantendo esse ritmo vocÃª evolui rÃ¡pido.",
      "Agora Ã© manter consistÃªncia."
    ]
  },

  crescimento: {
    observacao: [
      "Seu padrÃ£o financeiro estÃ¡ forte.",
      "VocÃª estÃ¡ construindo estabilidade real.",
      "Seu comportamento mudou de nÃ­vel."
    ],
    interpretacao: [
      "Isso Ã© maturidade financeira.",
      "VocÃª estÃ¡ Ã  frente da maioria.",
      "Sua estrutura estÃ¡ saudÃ¡vel."
    ],
    orientacao: [
      "Agora Ã© pensar em crescer.",
      "Considere metas maiores.",
      "VocÃª estÃ¡ pronto para o prÃ³ximo passo."
    ]
  }

};
  function escolherAleatorio(lista){
  return lista[Math.floor(Math.random() * lista.length)];
}
 function analisarSituacaoFinanceira(forcar = false){
   
  let novoEstado = calcularEstadoMentor();

  // Se nÃ£o for forÃ§ado e o estado nÃ£o mudou, nÃ£o fala
  if(!forcar && novoEstado === estadoMentorAtual){
    return;
  }

  let blocos = blocosMentor[novoEstado];

  if(!blocos) return;

  let observacao = escolherAleatorio(blocos.observacao);
  let interpretacao = escolherAleatorio(blocos.interpretacao);
  let orientacao = escolherAleatorio(blocos.orientacao);

  let mensagem = observacao + " " + interpretacao + " " + orientacao;

  estadoMentorAtual = novoEstado;

  mostrarMensagemMentor(mensagem);
}
 function mostrarMensagemMentor(texto){

  const banner = document.getElementById("mentorBanner");
  if(!banner) return;

  banner.innerHTML = `
    <div style="font-weight:600; font-size:13px; margin-bottom:8px; opacity:0.8;">
      ğŸ¤– EVELLYN // ANÃLISE FINANCEIRA
    </div>
    <div style="font-size:14px; line-height:1.5;">
      ${texto}
    </div>
  `;

  banner.style.display = "block";

  // Voz
  if ('speechSynthesis' in window) {
    const fala = new SpeechSynthesisUtterance(texto);
    fala.lang = 'pt-PT';
    fala.rate = 0.95;
    fala.pitch = 0.9; // mais robÃ³tico
    speechSynthesis.cancel();
    speechSynthesis.speak(fala);
  }

  // Enviar para notificaÃ§Ãµes
  adicionarNotificacao("analise", texto);

  setTimeout(() => {
    banner.style.display = "none";
  }, 8000);
}
  function renderizarNotificacoes(){

  const container = document.getElementById("listaNotificacoes");

  if(!container) return;

  container.innerHTML = "";

  if(notificacoes.length === 0){
    container.innerHTML = "Nenhuma notificaÃ§Ã£o.";
    return;
  }

  notificacoes.forEach((n, index) => {

    const div = document.createElement("div");

    div.style.background = "rgba(255,255,255,0.08)";
    div.style.padding = "12px";
    div.style.borderRadius = "8px";
    div.style.marginBottom = "10px";

   div.innerHTML =
  "<div style='display:flex; justify-content:space-between; align-items:flex-start;'>" +

    "<div style='flex:1;'>" +
      "<strong>" + n.mensagem + "</strong><br>" +
      "<span style='font-size:12px;opacity:0.6;'>" +
        n.data + " " + n.hora +
      "</span>" +
    "</div>" +

    "<button onclick='excluirNotificacao(" + index + ")' " +
      "style='background:#ff4d4d;border:none;color:white;padding:4px 8px;border-radius:6px;cursor:pointer;margin-left:10px;'>" +
      "âœ•" +
    "</button>" +

  "</div>";

    container.appendChild(div);

  });

}
  window.excluirNotificacao = function(index){
  notificacoes.splice(index, 1);
  renderizarNotificacoes();
}
  function autoRemoverNotificacao(elemento, tempo = 8000) {
  setTimeout(() => {
    elemento.classList.add("fade-out");

    setTimeout(() => {
      elemento.remove();
    }, 500);

  }, tempo);
}
function verificarEvolucaoPerfil(){

  const ordemPerfis = [
    "CrÃ­tico",
    "Iniciante",
    "Em EvoluÃ§Ã£o",
    "IntermediÃ¡rio",
    "EstÃ¡vel"
  ];

  if(!userProfile) return;

  const nivelAtualIndex = ordemPerfis.indexOf(userProfile);
  if(nivelAtualIndex === -1) return;

  const proximoNivel = nivelAtualIndex + 1;

  if(proximoNivel >= ordemPerfis.length) return;

  // ğŸ” VerificaÃ§Ãµes estruturais

  let temDivida = dividaAtual > 0;
  let saldoNegativo = saldo < 0;

  // Verificar contas vencidas
  let contasVencidas = false;
  const hoje = new Date();

  contas.forEach(conta => {
    if(conta.paga) return;

    const vencimento = new Date(conta.vencimento);
    if(vencimento < hoje){
      contasVencidas = true;
    }
  });

  // Verificar se jÃ¡ guardou pelo menos 1 meta completa
  let metaCumprida = metaMensal > 0 && valorGuardado >= metaMensal;

  // âœ… CondiÃ§Ã£o de evoluÃ§Ã£o
  if(
    !temDivida &&
    !saldoNegativo &&
    !contasVencidas &&
    metaCumprida
  ){

    const perfilAntigo = userProfile;

    userProfile = ordemPerfis[proximoNivel];

    const plano = planosPerfil[userProfile];
    if(plano){
      metaMensal = rendaMensalBase * plano.porcentagem;
    }

    document.getElementById("perfilTipo").innerText =
      "Perfil: " + userProfile;

    atualizarProgresso();

    // ğŸ’› Mensagem no tom amiga
    let mensagemEvolucao =
      "Olha vocÃª evoluindo ğŸ’› Eu sabia que vocÃª ia chegar aqui. Agora vocÃª estÃ¡ no perfil " +
      userProfile +
      ". Continua assim, vocÃª estÃ¡ construindo algo forte.";

    // ğŸ”¥ SÃ³ isso â€” nÃ£o chamar notificaÃ§Ã£o nem voz separadamente
    mostrarMensagemMentor(mensagemEvolucao);

    console.log("Evoluiu de", perfilAntigo, "para", userProfile);
  }

}
  function verificarContasVencendo(){

  const hoje = new Date();

  contas.forEach(conta => {

    if(conta.paga) return;

    const vencimento = new Date(conta.vencimento);
    const diffTime = vencimento - hoje;
    const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    // ğŸ”µ 3 dias
    if(diffDias === 3 && !conta.alertas.d3){
      adicionarNotificacao("info",
        "ğŸ“… A conta " + conta.nome + " vence em 3 dias."
      );
      conta.alertas.d3 = true;
    }

    // ğŸŸ¡ 2 dias
    if(diffDias === 2 && !conta.alertas.d2){
      adicionarNotificacao("alerta",
        "âš ï¸ A conta " + conta.nome + " vence em 2 dias."
      );
      conta.alertas.d2 = true;
    }

    // ğŸŸ  1 dia
    if(diffDias === 1 && !conta.alertas.d1){
      adicionarNotificacao("alerta",
        "â³ A conta " + conta.nome + " vence amanhÃ£."
      );
      conta.alertas.d1 = true;
    }

    // ğŸ”´ Hoje
    if(diffDias === 0 && !conta.alertas.hoje){
      adicionarNotificacao("erro",
        "ğŸš¨ A conta " + conta.nome + " vence hoje!"
      );
      conta.alertas.hoje = true;
    }

    // â˜ ï¸ Vencida
    if(diffDias < 0 && !conta.alertas.vencida){
      adicionarNotificacao("erro",
        "âŒ A conta " + conta.nome + " estÃ¡ vencida!"
      );
      conta.alertas.vencida = true;
    }

  });

}
  // ğŸ”” ATIVAR VERIFICAÃ‡ÃƒO AUTOMÃTICA
setInterval(verificarContasVencendo, 60000);
verificarContasVencendo();
  document.addEventListener("DOMContentLoaded", function(){

  const checkbox = document.getElementById("mutarEvellyn");

  if(checkbox){
    checkbox.addEventListener("change", function(){

      if(this.checked){
        speechSynthesis.cancel();   // para imediatamente qualquer fala
      }

    });
  }

});
  // torna a foto clicÃ¡vel
const foto = document.getElementById("fotoPerfil");
const input = document.getElementById("inputFoto");

foto.addEventListener("click", function(){
  input.click();
});

input.addEventListener("change", function(event){
  const arquivo = event.target.files[0];
  if(!arquivo) return;

  const leitor = new FileReader();

  leitor.onload = function(e){
    foto.src = e.target.result;
    localStorage.setItem("fotoPerfilSalva", e.target.result);
  };

  leitor.readAsDataURL(arquivo);
});

// carregar foto salva
const fotoSalva = localStorage.getItem("fotoPerfilSalva");
if(fotoSalva){
  foto.src = fotoSalva;
}
  const nomeEl = document.getElementById("nomeUsuario");
const inputNome = document.getElementById("inputNome");

// clicar no nome vira input
nomeEl.addEventListener("click", function(){
  inputNome.value = nomeEl.textContent;
  nomeEl.style.display = "none";
  inputNome.style.display = "inline-block";
  inputNome.focus();
});

// ao sair do input salva
inputNome.addEventListener("blur", function(){
  const novoNome = inputNome.value.trim();
  if(novoNome !== ""){
    nomeEl.textContent = novoNome;
    localStorage.setItem("nomeUsuarioSalvo", novoNome);
  }
  inputNome.style.display = "none";
  nomeEl.style.display = "block";
});

// carregar nome salvo
const nomeSalvo = localStorage.getItem("nomeUsuarioSalvo");
if(nomeSalvo){
  nomeEl.textContent = nomeSalvo;
}
  function diagnosticoHome(){

  let totalContasPendentes = 0;
  const hoje = new Date();

  contas.forEach(conta => {
    if(conta.paga) return;

    const vencimento = new Date(conta.vencimento);
    if(vencimento >= hoje){
      totalContasPendentes += conta.valor;
    }
  });

  let saldoReal = saldo - totalContasPendentes;

  // ğŸ” Descobrir maior categoria de gasto
  let maiorCategoria = null;
  let maiorValor = 0;

  categorias.forEach(cat => {
    let total = cat.subcategorias.reduce((acc, sub) => acc + sub.total, 0);
    if(total > maiorValor){
      maiorValor = total;
      maiorCategoria = cat.nome;
    }
  });

  let mensagem = "";

  mensagem += "ğŸ’° Saldo atual: " + moedaUsuario + " " + saldo.toFixed(2) + "<br>";

  if(totalContasPendentes > 0){
    mensagem += "ğŸ§¾ Contas pendentes: " + moedaUsuario + " " + totalContasPendentes.toFixed(2) + "<br>";
    mensagem += "ğŸ“Œ Saldo real disponÃ­vel: " + moedaUsuario + " " + saldoReal.toFixed(2) + "<br><br>";
  }

  if(maiorCategoria && maiorValor > 0){
    mensagem += "ğŸ“Š Seu maior gasto estÃ¡ em <strong>" + maiorCategoria + "</strong>: "
                + moedaUsuario + " " + maiorValor.toFixed(2) + "<br>";
    mensagem += "ğŸ‘‰ VÃ¡ em ğŸ“‚ Categorias para revisar.";
  }

  if(saldoReal > 0 && totalContasPendentes === 0){
    mensagem += "<br><br>ğŸš€ VocÃª tem dinheiro livre. Pode investir ou fortalecer sua reserva.";
  }

  document.getElementById("conteudoDiagnostico").innerHTML = mensagem;
}
  diagnosticoHome();
</script>
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", function() {
      navigator.serviceWorker.register("service-worker.js")
        .then(function(registration) {
          console.log("Service Worker registrado com sucesso:", registration.scope);
        })
        .catch(function(error) {
          console.log("Erro ao registrar Service Worker:", error);
        });
    });
  }
</script>
</body>
</html>


